<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERSYS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">\
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Slightly darker background for a professional feel */
        }
        /* Custom styles for select arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none; /* Remove default arrow */
        }
        select::-ms-expand {
            display: none; /* Hide arrow in IE/Edge */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #bdbdbd;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script type="text/javascript">
        console.log("Script principal começando a carregar.");
        // Manual SVG Icons from Lucide React
        const icons = {
            FileText: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15 2z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',
            PlusCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>',
            Search: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            Building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 18h.01"/></svg>',
            Truck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M19 18h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-1V6a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>',
            UserCheck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="22 7 18 11 16 9"/></svg>',
            LogOut: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="11" y1="12" y2="12"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>',
            Menu: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>',
            X: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            ChevronDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>',
            ChevronUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="m18 15-6-6-6 6"/></svg>',
            LayoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>',
            CalendarDays: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>',
            User: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
            Users: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            Settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l-.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',
            ArrowLeftRight: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-arrow-left-right"><path d="M8 3L4 7L8 11"/><path d="M4 7h16"/><path d="M16 21l4-4l-4-4"/><path d="M20 17H4"/></svg>',
            ArrowLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>',
            MapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M12 18.3a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6z"/><path d="M12 2C7.58 2 4 5.58 4 10c0 5.57 8 12 8 12s8-6.43 8-12c0-4.42-3.58-8-8-8z"/></svg>',
            Factory: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-factory"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 9.86 2H7.14a2 2 0 0 0-1.66.9l-.82 1.2A2 2 0 0 1 4 6H2v14z"/><path d="M10 10v4"/><path d="M14 10v4"/><path d="M18 10v4"/><path d="M6 10v4"/></svg>',
            Edit: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
            Save: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>',
            Ban: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ban"><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></svg>',
            DollarSign: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>'
        };
        // Componente de Mensagem/Toast
        function Toast({ message, type, onClose }) {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? '✔' : '✖'; // Simple icons for now

            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000); // Auto-close after 3 seconds
                return () => clearTimeout(timer);
            }, [onClose]);
            return (
                React.createElement('div', { className: `fixed bottom-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg flex items-center space-x-2 z-50 transition-all duration-300 ease-in-out transform translate-y-0 opacity-100` },
                    React.createElement('span', { className: "font-bold text-xl" }, icon),
                    React.createElement('p', null, message),
                    React.createElement('button', { onClick: onClose, className: "ml-4 font-bold opacity-75 hover:opacity-100 transition-opacity" }, 'X')
                )
            );
        }

        // Componente de Confirmação Modal
        function ConfirmationModal({ message, onConfirm, onCancel }) {
            return (
                React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fade-in" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 animate-scale-in" },
                        React.createElement('p', { className: "text-lg font-semibold text-gray-800 mb-6" }, message),
                        React.createElement('div', { className: "flex justify-center space-x-4" },
                            React.createElement('button', {
                                onClick: onConfirm,
                                className: "px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Confirmar"),
                            React.createElement('button', {
                                onClick: onCancel,
                                className: "px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Cancelar")
                        )
                    )
                )
            );
        }

        // Helper function to render Lucide icons
        function LucideIcon({ name, className }) {
            return React.createElement('span', {
                className: className,
                dangerouslySetInnerHTML: { __html: icons[name] || '' }
            });
        }

        // Wrap the entire React app rendering logic within window.onload
        window.onload = function() {
            console.log("window.onload disparado.");
            // Supabase client initialization
            // Substitua pelos seus dados reais do Supabase
            const SUPABASE_URL = 'https://gfivmnnysomfwrffybeh.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmaXZtbm55c29tZndyZmZ5YmVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTY3NjgsImV4cCI6MjA2ODg3Mjc2OH0.NxetXJoCLh4q9zAqn_olimziI3YP4MAJzB8ed4qf8cg';

            let supabase;

            // Function to initialize Supabase and render the App
            const initializeSupabaseAndRenderApp = () => {
                try {
                    console.log("Tentando inicializar o cliente Supabase...");
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Cliente Supabase inicializado com sucesso.");
                    ReactDOM.render(React.createElement(App, null), document.getElementById('root'));
                } catch (e) {
                    console.error("Erro ao inicializar o cliente Supabase:", e);
                    ReactDOM.render(
                        React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                            React.createElement('h1', null, 'Erro ao Inicializar Supabase'),
                            React.createElement('p', null, `Ocorreu um erro ao inicializar o cliente Supabase: ${e.message}. Verifique as suas credenciais e a configuração do projeto Supabase.`)
                        ),
                        document.getElementById('root')
                    );
                }
            };
            // Dynamically load Supabase library
            const supabaseScript = document.createElement('script');
            supabaseScript.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.0/dist/umd/supabase.min.js";
            supabaseScript.onload = () => {
                console.log("Biblioteca Supabase carregada com sucesso.");
                initializeSupabaseAndRenderApp();
            };
            supabaseScript.onerror = (error) => {
                console.error("Erro ao carregar a biblioteca Supabase:", error);
                ReactDOM.render(
                    React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                        React.createElement('h1', null, 'Erro ao Carregar Aplicação'),
                        React.createElement('p', null, 'A biblioteca Supabase não foi carregada. Por favor, verifique a sua ligação à internet ou o link CDN do Supabase no código HTML.')
                    ),
                    document.getElementById('root')
                );
            };
            document.head.appendChild(supabaseScript);

            // Global variable for app ID (from Canvas environment, if applicable, otherwise default)
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            // Componente para a tela de Login
            function LoginPage({ onLogin }) {
                const [username, setUsername] = React.useState('');
                const [password, setPassword] = React.useState('');
                const [error, setError] = React.useState('');
                const [isLoggingIn, setIsLoggingIn] = React.useState(false);
                const handleLogin = async (e) => {
                    e.preventDefault();
                    setIsLoggingIn(true);
                    setError('');

                    if (!username || !password) {
                        setError('Por favor, insira seu usuário e senha.');
                        setIsLoggingIn(false);
                        return;
                    }

                    await new Promise(resolve => setTimeout(resolve, 1000));
                    let role = null;

                    try {
                        console.log("Tentando login com username:", username.toLowerCase(), "e password:", password);
                        const { data, error: fetchError } = await supabase
                            .from('app_users')
                            .select('*')
                            .eq('username', username.toLowerCase())
                            .eq('password', password);
                        console.log("Resultado da consulta Supabase (data):", data);
                        console.log("Resultado da consulta Supabase (erro):", fetchError);
                        if (fetchError) {
                            console.error("Erro ao buscar usuário no Supabase:", fetchError);
                            setError("Erro ao autenticar. Por favor, tente novamente.");
                        } else if (data && data.length > 0) {
                            role = data[0].role;
                            // Salvar informações do usuário no localStorage após login bem-sucedido
                            localStorage.setItem('userRole', role);
                            localStorage.setItem('userId', username.toLowerCase()); // Usar o username como userId
                        } else {
                            setError('Usuário ou senha inválidos.');
                        }
                    } catch (e) {
                        console.error("Erro inesperado ao buscar usuário no Supabase:", e);
                        setError("Erro ao autenticar. Por favor, tente novamente.");
                    }


                    if (role) {
                        onLogin(role, username.toLowerCase()); // Pass username as userId for data partitioning
                    } else {
                        if (!error) {
                            setError('Usuário ou senha inválidos.');
                        }
                    }
                    setIsLoggingIn(false);
                };

                return (
                    React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100 font-sans" },
                        React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-lg w-full max-w-md" },
                            // Logo TERSYS
                            React.createElement('div', { className: "flex flex-col items-center justify-center mb-6" },
                                React.createElement('img', {
                                    src: "https://gfivmnnysomfwrffybeh.supabase.co/storage/v1/object/public/logo//LOGO_TERSYS-removebg-preview%20(1).png",
                                    alt: "TERSYS Logo",
                                    className: "h-32 w-auto mb-4" // Ajuste o tamanho conforme necessário
                                })
                            ),
                            error && (
                                React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                    React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                    React.createElement('span', { className: "block sm:inline" }, " ", error)
                                )
                            ),
                            React.createElement('form', { onSubmit: handleLogin },
                                React.createElement('div', { className: "mb-4" },
                                    React.createElement('label', { htmlFor: "username", className: "block text-sm font-medium text-gray-700 mb-1" }, "Usuário"),
                                    React.createElement('input', {
                                        type: "text",
                                        id: "username",
                                        value: username,
                                        onChange: (e) => {
                                            setUsername(e.target.value);
                                            setError('');
                                        },
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                        placeholder: "Digite seu usuário",
                                        required: true,
                                        disabled: isLoggingIn
                                    })
                                ),
                                React.createElement('div', { className: "mb-6" },
                                    React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                                    React.createElement('input', {
                                        type: "password",
                                        id: "password",
                                        value: password,
                                        onChange: (e) => setPassword(e.target.value),
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                        placeholder: "Digite sua senha",
                                        required: true,
                                        disabled: isLoggingIn
                                    })
                                ),
                                React.createElement('button', {
                                    type: "submit",
                                    className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoggingIn
                                },
                                    isLoggingIn ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: "UserCheck", className: "mr-2 h-5 w-5" })
                                    ),
                                    isLoggingIn ? 'Entrando...' : 'Entrar'
                                )
                            )
                        )
                    )
                );
            }

            // Componente para Gerenciamento de Filiais
            function BranchManagement({ userId, userRole, showToast }) {
                const [newBranchName, setNewBranchName] = React.useState('');
                const [branches, setBranches] = React.useState([]);
                const [responsibleInput, setResponsibleInput] = React.useState("");
                // Este é para o campo de adição de nova filial
                const [error, setError] = React.useState(null);
                const [isLoading, setIsLoading] = React.useState(false);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [branchToDelete, setBranchToDelete] = React.useState(null);
                const [editingBranch, setEditingBranch] = React.useState(null);
                // Armazena a filial sendo editada
                const [originalBranch, setOriginalBranch] = React.useState(null);
                // Armazena a filial original antes da edição
                const [availableSupervisors, setAvailableSupervisors] = React.useState([]);
                // Novo estado para supervisores disponíveis

                React.useEffect(() => {
                    if (!userId || !userRole) return;

                    const fetchBranchesAndSupervisors = async () => {
                        setIsLoading(true);

                        // Fetch filiais
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data: branchesData, error: fetchBranchesError } = await query;

                        if (fetchBranchesError) {
                            console.error("Erro ao buscar filiais:", fetchBranchesError);
                            setError("Erro ao carregar filiais.");
                            showToast("Erro ao carregar filiais.", "error");
                        } else {
                            setBranches(branchesData);
                        }

                        // Fetch supervisors
                        const { data: supervisorsData, error: fetchSupervisorsError } = await supabase
                            .from('app_users')
                            .select('username')
                            .eq('role', 'supervisor')
                            .order('username', { ascending: true });
                        if (fetchSupervisorsError) {
                            console.error("Erro ao buscar supervisores:", fetchSupervisorsError);
                            setError("Erro ao carregar supervisores.");
                            showToast("Erro ao carregar supervisores.", "error");
                        } else {
                            setAvailableSupervisors(supervisorsData.map(u => u.username));
                        }
                        setIsLoading(false);
                    };
                    fetchBranchesAndSupervisors();
                }, [userId, userRole, showToast]);
                const handleAddBranch = async (e) => {
                    e.preventDefault();
                    const trimmedBranchName = newBranchName.trim();
                    if (!trimmedBranchName) {
                        setError("O nome da filial não pode estar vazio.");
                        showToast("O nome da filial não pode estar vazio.", "error");
                        return;
                    }
                    if (!responsibleInput.trim()) {
                        setError("Por favor, selecione um responsável para a nova filial.");
                        showToast("Selecione um responsável.", "error");
                        return;
                    }
                    setIsLoading(true);
                    try {
                        // Check for duplicate branch name (case-insensitive)
                        const { data: existingBranches, error: checkError } = await supabase
                            .from('filiais')
                            .select('id')
                            .ilike('name', trimmedBranchName);
                        // ilike for case-insensitive check
                        if (checkError) throw checkError;
                        if (existingBranches && existingBranches.length > 0) {
                            setError("Já existe uma filial com este nome. Por favor, escolha outro.");
                            showToast("Filial já existe.", "error");
                            setIsLoading(false);
                            return;
                        }
                        const { error: insertError } = await supabase
                            .from('filiais')
                            .insert([
                                { name: trimmedBranchName, created_by_username: userId, responsible: responsibleInput.trim(), },
                            ]);
                        if (insertError) throw insertError;
                        setNewBranchName('');
                        setResponsibleInput("");
                        setError(null);
                        showToast("Filial adicionada com sucesso!", "success");
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data } = await query;
                        setBranches(data);
                    } catch (e) {
                        console.error("Erro ao adicionar filial:", e);
                        setError("Erro ao adicionar filial.");
                        showToast("Erro ao adicionar filial.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };
                const handleEditClick = (branch) => {
                    setEditingBranch({ ...branch });
                    setOriginalBranch({ ...branch });
                };
                const handleCancelEdit = () => {
                    setEditingBranch(null);
                    setOriginalBranch(null);
                    setBranches(prevBranches => prevBranches.map(b => b.id === originalBranch.id ? originalBranch : b));
                };
                const handleUpdateBranch = async () => {
                    if (!editingBranch) return;
                    const trimmedBranchName = editingBranch.name.trim();
                    if (!trimmedBranchName) {
                        setError("O nome da filial não pode estar vazio.");
                        showToast("O nome da filial não pode estar vazio.", "error");
                        return;
                    }
                    if (!editingBranch.responsible.trim()) {
                        setError("Por favor, selecione um responsável para a filial.");
                        showToast("Selecione um responsável.", "error");
                        return;
                    }
                    setIsLoading(true);
                    try {
                        // Check for duplicate branch name (case-insensitive), excluding the current branch being edited
                        const { data: existingBranches, error: checkError } = await supabase
                            .from('filiais')
                            .select('id')
                            .ilike('name', trimmedBranchName)
                            .neq('id', editingBranch.id);
                        // Exclude current branch from check
                        if (checkError) throw checkError;
                        if (existingBranches && existingBranches.length > 0) {
                            setError("Já existe outra filial com este nome. Por favor, escolha outro.");
                            showToast("Nome de filial duplicado.", "error");
                            setIsLoading(false);
                            return;
                        }
                        const { error: updateError } = await supabase
                            .from('filiais')
                            .update({ name: trimmedBranchName, responsible: editingBranch.responsible.trim() })
                            .eq('id', editingBranch.id);
                        if (updateError) throw updateError;
                        showToast("Filial atualizada com sucesso!", "success");
                        setEditingBranch(null);
                        setOriginalBranch(null);
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data } = await query;
                        setBranches(data);
                    } catch (e) {
                        console.error("Erro ao atualizar filial:", e);
                        setError("Erro ao atualizar filial.");
                        showToast("Erro ao atualizar filial.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };
                const handleFieldChange = (e, fieldName) => {
                    setEditingBranch(prev => ({ ...prev, [fieldName]: e.target.value }));
                };
                const confirmDeleteBranch = (branch) => {
                    setBranchToDelete(branch);
                    setShowConfirmModal(true);
                };
                const handleDeleteBranch = async () => {
                    if (!branchToDelete) return;
                    setIsLoading(true);
                    setShowConfirmModal(false);
                    try {
                        const { error: deleteError } = await supabase
                            .from('filiais')
                            .delete()
                            .eq('id', branchToDelete.id);
                        if (deleteError) throw deleteError;
                        showToast("Filial excluída com sucesso!", "success");
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data } = await query;
                        setBranches(data);
                    } catch (e) {
                        console.error("Erro ao excluir filial:", e);
                        showToast("Erro ao excluir filial.", "error");
                    } finally {
                        setIsLoading(false);
                        setBranchToDelete(null);
                    }
                };
                // Renderização do componente BranchManagement...
                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('h1', { className: "text-2xl md:text-3xl font-bold text-gray-800 mb-6" }, "Gerenciar Filiais"),
                        userRole === 'administrador' && (
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg mb-6" },
                                React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Adicionar Nova Filial"),
                                React.createElement('form', { onSubmit: handleAddBranch, className: "space-y-4" },
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                        React.createElement('div', null,
                                            React.createElement('label', { htmlFor: "newBranchName", className: "block text-sm font-medium text-gray-700" }, "Nome da Filial"),
                                            React.createElement('input', {
                                                type: "text",
                                                id: "newBranchName",
                                                value: newBranchName,
                                                onChange: (e) => {
                                                    setNewBranchName(e.target.value);
                                                    setError(null);
                                                },
                                                className: "mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out",
                                                required: true,
                                                disabled: isLoading
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { htmlFor: "responsibleInput", className: "block text-sm font-medium text-gray-700" }, "Responsável"),
                                            React.createElement('select', {
                                                id: "responsibleInput",
                                                value: responsibleInput,
                                                onChange: (e) => {
                                                    setResponsibleInput(e.target.value);
                                                    setError(null);
                                                },
                                                className: "mt-1 block w-full px-4 py-2 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out",
                                                required: true,
                                                disabled: isLoading
                                            },
                                                React.createElement('option', { value: "", disabled: true }, "Selecione um supervisor"),
                                                availableSupervisors.map(username =>
                                                    React.createElement('option', { key: username, value: username }, username)
                                                )
                                            )
                                        )
                                    ),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: `w-full md:w-auto px-6 py-2.5 rounded-lg shadow-md text-white font-semibold transition duration-300 ease-in-out transform ${isLoading ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 hover:scale-105'}`,
                                        disabled: isLoading
                                    },
                                        isLoading ? "Adicionando..." : "Adicionar Filial"
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg overflow-x-auto" },
                            React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Filiais Atuais"),
                            isLoading ? (
                                React.createElement('div', { className: "text-center py-10" }, "Carregando filiais...")
                            ) : (
                                React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                    React.createElement('thead', { className: "bg-gray-50" },
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Nome"),
                                            React.createElement('th', { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Criado por"),
                                            React.createElement('th', { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Responsável"),
                                            React.createElement('th', { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Criado em"),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                        branches.length > 0 ? (
                                            branches.map(branch => (
                                                React.createElement('tr', { key: branch.id },
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                                                        editingBranch && editingBranch.id === branch.id ?
                                                            React.createElement('input', {
                                                                type: "text",
                                                                value: editingBranch.name,
                                                                onChange: (e) => handleFieldChange(e, 'name'),
                                                                className: "px-2 py-1 border border-gray-300 rounded-md"
                                                            }) :
                                                            branch.name
                                                    ),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, branch.created_by_username),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                                                        editingBranch && editingBranch.id === branch.id ?
                                                            React.createElement('select', {
                                                                value: editingBranch.responsible,
                                                                onChange: (e) => handleFieldChange(e, 'responsible'),
                                                                className: "px-2 py-1 border border-gray-300 rounded-md"
                                                            },
                                                                availableSupervisors.map(username =>
                                                                    React.createElement('option', { key: username, value: username }, username)
                                                                )
                                                            ) :
                                                            branch.responsible
                                                    ),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, new Date(branch.created_at).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                        editingBranch && editingBranch.id === branch.id ? (
                                                            React.createElement(React.Fragment, null,
                                                                React.createElement('button', {
                                                                    onClick: handleUpdateBranch,
                                                                    className: "text-green-600 hover:text-green-900 transition-colors mr-2"
                                                                }, React.createElement(LucideIcon, { name: "Save", className: "inline-block h-5 w-5" })),
                                                                React.createElement('button', {
                                                                    onClick: handleCancelEdit,
                                                                    className: "text-gray-600 hover:text-gray-900 transition-colors"
                                                                }, React.createElement(LucideIcon, { name: "Ban", className: "inline-block h-5 w-5" }))
                                                            )
                                                        ) : (
                                                            React.createElement(React.Fragment, null,
                                                                React.createElement('button', {
                                                                    onClick: () => handleEditClick(branch),
                                                                    className: "text-blue-600 hover:text-blue-900 transition-colors mr-2"
                                                                }, React.createElement(LucideIcon, { name: "Edit", className: "inline-block h-5 w-5" })),
                                                                React.createElement('button', {
                                                                    onClick: () => confirmDeleteBranch(branch),
                                                                    className: "text-red-600 hover:text-red-900 transition-colors"
                                                                }, React.createElement(LucideIcon, { name: "Trash2", className: "inline-block h-5 w-5" }))
                                                            )
                                                        )
                                                    )
                                                )
                                            ))
                                        ) : (
                                            React.createElement('tr', null,
                                                React.createElement('td', { colSpan: userRole === 'administrador' ? 5 : 4, className: "px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500" }, "Nenhuma filial encontrada.")
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        showConfirmModal && React.createElement(ConfirmationModal, {
                            message: `Tem certeza que deseja excluir a filial "${branchToDelete.name}"?`,
                            onConfirm: handleDeleteBranch,
                            onCancel: () => setShowConfirmModal(false)
                        })
                    )
                );
            }

            // Componente para Gerenciamento de Equipamentos
            function EquipmentManagement({ userId, showToast }) {
                // Conteúdo existente para Gerenciamento de Equipamentos...
                return null;
            }

            // Componente para Gerenciamento de Usuários
            function UserManagement({ userId, showToast }) {
                // Conteúdo existente para Gerenciamento de Usuários...
                return null;
            }

            // Componente para Distribuição de Terceiros
            function OutsourcingDistribution({ userId, showToast, setCurrentPage }) {
                // Conteúdo existente para Distribuição de Terceiros...
                return null;
            }

            // Componente para Transferência de Filiais
            function BranchTransfer({ userId, setCurrentPage, showToast }) {
                // Conteúdo existente para Transferência de Filiais...
                return null;
            }
            
            function PricingPage({ userRole, showToast }) {
                const [subPage, setSubPage] = React.useState('deslocamentos'); // Estado para controlar o subtópico

                const renderSubPage = () => {
                    switch (subPage) {
                        case 'deslocamentos':
                            return React.createElement(DisplacementPricing, { userRole, showToast });
                        case 'adicionalCidades':
                            return React.createElement(CityAdditionalPricing, { userRole, showToast });
                        case 'precoFixo':
                            return React.createElement(FixedPricing, { userRole, showToast });
                        default:
                            return React.createElement('div', null, 'Selecione um subtópico.');
                    }
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('h1', { className: "text-2xl md:text-3xl font-bold text-gray-800 mb-6" }, "Precificação"),
                        React.createElement('div', { className: "flex space-x-4 mb-6" },
                            React.createElement('button', {
                                onClick: () => setSubPage('deslocamentos'),
                                className: `px-4 py-2 rounded-lg text-sm font-medium transition duration-300 ${subPage === 'deslocamentos' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`
                            }, "Deslocamentos"),
                            React.createElement('button', {
                                onClick: () => setSubPage('adicionalCidades'),
                                className: `px-4 py-2 rounded-lg text-sm font-medium transition duration-300 ${subPage === 'adicionalCidades' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`
                            }, "Adicional Cidades"),
                            React.createElement('button', {
                                onClick: () => setSubPage('precoFixo'),
                                className: `px-4 py-2 rounded-lg text-sm font-medium transition duration-300 ${subPage === 'precoFixo' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`
                            }, "Preço Fixo")
                        ),
                        renderSubPage()
                    )
                );
            }

            function DisplacementPricing({ userRole, showToast }) {
                const [data, setData] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [editingRecord, setEditingRecord] = React.useState(null);
                const [formData, setFormData] = React.useState({});

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    const { data, error } = await supabase
                        .from('deslocamentos')
                        .select('*')
                        .is('data_encerramento', null)
                        .order('data_criacao', { ascending: false });

                    if (error) {
                        console.error("Erro ao buscar dados de deslocamentos:", error);
                        showToast("Erro ao carregar dados de deslocamentos.", "error");
                    } else {
                        setData(data);
                    }
                    setIsLoading(false);
                };

                const handleEditClick = (record) => {
                    setEditingRecord(record);
                    setFormData(record);
                };

                const handleCancelEdit = () => {
                    setEditingRecord(null);
                    setFormData({});
                };

                const handleFieldChange = (e) => {
                    setFormData({ ...formData, [e.target.name]: e.target.value });
                };

                const handleSave = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);

                    try {
                        if (editingRecord) {
                            // Encerrar o registro antigo
                            const { error: endError } = await supabase
                                .from('deslocamentos')
                                .update({ data_encerramento: new Date().toISOString() })
                                .eq('id', editingRecord.id);

                            if (endError) throw endError;
                        }

                        // Criar um novo registro com os dados atuais
                        const { error: insertError } = await supabase
                            .from('deslocamentos')
                            .insert([formData]);

                        if (insertError) throw insertError;

                        showToast(`Registro ${editingRecord ? 'atualizado' : 'adicionado'} com sucesso!`, "success");
                        handleCancelEdit();
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao salvar registro:", e);
                        showToast("Erro ao salvar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const tableHeaders = ["Tipo de Implemento", "Filial Origem", "Filial Destino", "KM", "Valor", "Data Criação"];

                return (
                    React.createElement('div', null,
                        userRole === 'administrador' && (
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg mb-6" },
                                React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, editingRecord ? "Editar Registro" : "Adicionar Novo Registro"),
                                React.createElement('form', { onSubmit: handleSave, className: "space-y-4" },
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                        React.createElement('input', { type: "text", name: "tipo_de_implemento", placeholder: "Tipo de Implemento", value: formData.tipo_de_implemento || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "text", name: "filial_origem", placeholder: "Filial Origem", value: formData.filial_origem || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "text", name: "filial_destino", placeholder: "Filial Destino", value: formData.filial_destino || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "number", name: "km", placeholder: "KM", value: formData.km || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "number", name: "valor", placeholder: "Valor", value: formData.valor || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                    ),
                                    React.createElement('div', { className: "flex space-x-2" },
                                        React.createElement('button', { type: "submit", disabled: isLoading, className: "px-6 py-2.5 rounded-lg text-white font-semibold transition duration-300 bg-blue-600 hover:bg-blue-700" }, isLoading ? "Salvando..." : "Salvar"),
                                        editingRecord && React.createElement('button', { type: "button", onClick: handleCancelEdit, className: "px-6 py-2.5 rounded-lg text-gray-800 bg-gray-200 hover:bg-gray-300" }, "Cancelar")
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg overflow-x-auto" },
                            React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Tabela de Deslocamentos"),
                            isLoading ? (
                                React.createElement('div', { className: "text-center py-10" }, "Carregando dados...")
                            ) : (
                                React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                    React.createElement('thead', { className: "bg-gray-50" },
                                        React.createElement('tr', null,
                                            tableHeaders.map(header => React.createElement('th', { key: header, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, header)),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                        data.length > 0 ? (
                                            data.map(record =>
                                                React.createElement('tr', { key: record.id },
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.tipo_de_implemento),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.filial_origem),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.filial_destino),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.km),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.valor),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, new Date(record.data_criacao).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                        React.createElement('button', {
                                                            onClick: () => handleEditClick(record),
                                                            className: "text-blue-600 hover:text-blue-900 transition-colors"
                                                        }, React.createElement(LucideIcon, { name: "Edit", className: "inline-block h-5 w-5" }))
                                                    )
                                                )
                                            )
                                        ) : (
                                            React.createElement('tr', null,
                                                React.createElement('td', { colSpan: userRole === 'administrador' ? 7 : 6, className: "px-6 py-4 text-center text-sm text-gray-500" }, "Nenhum dado encontrado.")
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            function CityAdditionalPricing({ userRole, showToast }) {
                const [data, setData] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [editingRecord, setEditingRecord] = React.useState(null);
                const [formData, setFormData] = React.useState({});

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    const { data, error } = await supabase
                        .from('adicionais_cidades')
                        .select('*')
                        .is('data_encerramento', null)
                        .order('data_criacao', { ascending: false });

                    if (error) {
                        console.error("Erro ao buscar dados de adicionais_cidades:", error);
                        showToast("Erro ao carregar dados de adicionais_cidades.", "error");
                    } else {
                        setData(data);
                    }
                    setIsLoading(false);
                };

                const handleEditClick = (record) => {
                    setEditingRecord(record);
                    setFormData(record);
                };

                const handleCancelEdit = () => {
                    setEditingRecord(null);
                    setFormData({});
                };

                const handleFieldChange = (e) => {
                    setFormData({ ...formData, [e.target.name]: e.target.value });
                };

                const handleSave = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);

                    try {
                        if (editingRecord) {
                            const { error: endError } = await supabase
                                .from('adicionais_cidades')
                                .update({ data_encerramento: new Date().toISOString() })
                                .eq('id', editingRecord.id);

                            if (endError) throw endError;
                        }

                        const { error: insertError } = await supabase
                            .from('adicionais_cidades')
                            .insert([formData]);

                        if (insertError) throw insertError;

                        showToast(`Registro ${editingRecord ? 'atualizado' : 'adicionado'} com sucesso!`, "success");
                        handleCancelEdit();
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao salvar registro:", e);
                        showToast("Erro ao salvar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const tableHeaders = ["Filial", "Município", "KM", "Valor", "Data Criação"];

                return (
                    React.createElement('div', null,
                        userRole === 'administrador' && (
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg mb-6" },
                                React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, editingRecord ? "Editar Registro" : "Adicionar Novo Registro"),
                                React.createElement('form', { onSubmit: handleSave, className: "space-y-4" },
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                        React.createElement('input', { type: "text", name: "filial", placeholder: "Filial", value: formData.filial || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "text", name: "municipio", placeholder: "Município", value: formData.municipio || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "number", name: "km", placeholder: "KM", value: formData.km || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "number", name: "valor", placeholder: "Valor", value: formData.valor || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                    ),
                                    React.createElement('div', { className: "flex space-x-2" },
                                        React.createElement('button', { type: "submit", disabled: isLoading, className: "px-6 py-2.5 rounded-lg text-white font-semibold transition duration-300 bg-blue-600 hover:bg-blue-700" }, isLoading ? "Salvando..." : "Salvar"),
                                        editingRecord && React.createElement('button', { type: "button", onClick: handleCancelEdit, className: "px-6 py-2.5 rounded-lg text-gray-800 bg-gray-200 hover:bg-gray-300" }, "Cancelar")
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg overflow-x-auto" },
                            React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Tabela de Adicionais Cidades"),
                            isLoading ? (
                                React.createElement('div', { className: "text-center py-10" }, "Carregando dados...")
                            ) : (
                                React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                    React.createElement('thead', { className: "bg-gray-50" },
                                        React.createElement('tr', null,
                                            tableHeaders.map(header => React.createElement('th', { key: header, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, header)),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                        data.length > 0 ? (
                                            data.map(record =>
                                                React.createElement('tr', { key: record.id },
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.filial),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.municipio),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.km),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.valor),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, new Date(record.data_criacao).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                        React.createElement('button', {
                                                            onClick: () => handleEditClick(record),
                                                            className: "text-blue-600 hover:text-blue-900 transition-colors"
                                                        }, React.createElement(LucideIcon, { name: "Edit", className: "inline-block h-5 w-5" }))
                                                    )
                                                )
                                            )
                                        ) : (
                                            React.createElement('tr', null,
                                                React.createElement('td', { colSpan: userRole === 'administrador' ? 6 : 5, className: "px-6 py-4 text-center text-sm text-gray-500" }, "Nenhum dado encontrado.")
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            function FixedPricing({ userRole, showToast }) {
                const [data, setData] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [editingRecord, setEditingRecord] = React.useState(null);
                const [formData, setFormData] = React.useState({});

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    const { data, error } = await supabase
                        .from('precos_fixos')
                        .select('*')
                        .is('data_encerramento', null)
                        .order('data_criacao', { ascending: false });

                    if (error) {
                        console.error("Erro ao buscar dados de precos_fixos:", error);
                        showToast("Erro ao carregar dados de precos_fixos.", "error");
                    } else {
                        setData(data);
                    }
                    setIsLoading(false);
                };

                const handleEditClick = (record) => {
                    setEditingRecord(record);
                    setFormData(record);
                };

                const handleCancelEdit = () => {
                    setEditingRecord(null);
                    setFormData({});
                };

                const handleFieldChange = (e) => {
                    setFormData({ ...formData, [e.target.name]: e.target.value });
                };

                const handleSave = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);

                    try {
                        if (editingRecord) {
                            const { error: endError } = await supabase
                                .from('precos_fixos')
                                .update({ data_encerramento: new Date().toISOString() })
                                .eq('id', editingRecord.id);

                            if (endError) throw endError;
                        }

                        const { error: insertError } = await supabase
                            .from('precos_fixos')
                            .insert([formData]);

                        if (insertError) throw insertError;

                        showToast(`Registro ${editingRecord ? 'atualizado' : 'adicionado'} com sucesso!`, "success");
                        handleCancelEdit();
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao salvar registro:", e);
                        showToast("Erro ao salvar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const tableHeaders = ["Tipo de Implemento", "Filial", "Preço", "Data Criação"];

                return (
                    React.createElement('div', null,
                        userRole === 'administrador' && (
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg mb-6" },
                                React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, editingRecord ? "Editar Registro" : "Adicionar Novo Registro"),
                                React.createElement('form', { onSubmit: handleSave, className: "space-y-4" },
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                        React.createElement('input', { type: "text", name: "tipo_de_implemento", placeholder: "Tipo de Implemento", value: formData.tipo_de_implemento || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "text", name: "filial", placeholder: "Filial", value: formData.filial || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                        React.createElement('input', { type: "number", name: "preco", placeholder: "Preço", value: formData.preco || "", onChange: handleFieldChange, className: "mt-1 block w-full px-4 py-2 border rounded-lg" }),
                                    ),
                                    React.createElement('div', { className: "flex space-x-2" },
                                        React.createElement('button', { type: "submit", disabled: isLoading, className: "px-6 py-2.5 rounded-lg text-white font-semibold transition duration-300 bg-blue-600 hover:bg-blue-700" }, isLoading ? "Salvando..." : "Salvar"),
                                        editingRecord && React.createElement('button', { type: "button", onClick: handleCancelEdit, className: "px-6 py-2.5 rounded-lg text-gray-800 bg-gray-200 hover:bg-gray-300" }, "Cancelar")
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg overflow-x-auto" },
                            React.createElement('h2', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Tabela de Preços Fixos"),
                            isLoading ? (
                                React.createElement('div', { className: "text-center py-10" }, "Carregando dados...")
                            ) : (
                                React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                    React.createElement('thead', { className: "bg-gray-50" },
                                        React.createElement('tr', null,
                                            tableHeaders.map(header => React.createElement('th', { key: header, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" }, header)),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                        data.length > 0 ? (
                                            data.map(record =>
                                                React.createElement('tr', { key: record.id },
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.tipo_de_implemento),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.filial),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, record.preco),
                                                    React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" }, new Date(record.data_criacao).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                        React.createElement('button', {
                                                            onClick: () => handleEditClick(record),
                                                            className: "text-blue-600 hover:text-blue-900 transition-colors"
                                                        }, React.createElement(LucideIcon, { name: "Edit", className: "inline-block h-5 w-5" }))
                                                    )
                                                )
                                            )
                                        ) : (
                                            React.createElement('tr', null,
                                                React.createElement('td', { colSpan: userRole === 'administrador' ? 5 : 4, className: "px-6 py-4 text-center text-sm text-gray-500" }, "Nenhum dado encontrado.")
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }
            // App component
            function App() {
                const [isLoggedIn, setIsLoggedIn] = React.useState(false);
                const [userRole, setUserRole] = React.useState('');
                const [userId, setUserId] = React.useState('');
                const [currentPage, setCurrentPage] = React.useState('dashboard');
                const [isSidebarOpen, setIsSidebarOpen] = React.useState(true);
                const [toastMessage, setToastMessage] = React.useState('');
                const [toastType, setToastType] = React.useState('success');

                React.useEffect(() => {
                    const storedRole = localStorage.getItem('userRole');
                    const storedId = localStorage.getItem('userId');
                    if (storedRole && storedId) {
                        setIsLoggedIn(true);
                        setUserRole(storedRole);
                        setUserId(storedId);
                    }
                }, []);

                const handleLogin = (role, id) => {
                    setIsLoggedIn(true);
                    setUserRole(role);
                    setUserId(id);
                    setCurrentPage('dashboard');
                };

                const handleLogout = () => {
                    localStorage.removeItem('userRole');
                    localStorage.removeItem('userId');
                    setIsLoggedIn(false);
                    setUserRole('');
                    setUserId('');
                    setCurrentPage('dashboard');
                };
                
                const showToast = (message, type) => {
                  setToastMessage(message);
                  setToastType(type);
                };

                const clearToast = () => {
                  setToastMessage('');
                };

                if (!isLoggedIn) {
                    return React.createElement(LoginPage, { onLogin: handleLogin });
                }

                // Main App Layout
                return (
                    React.createElement('div', { className: "flex min-h-screen bg-gray-100 font-sans antialiased text-gray-800" },
                        // Sidebar
                        React.createElement('div', { className: `fixed z-40 inset-y-0 left-0 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition-transform duration-300 ease-in-out w-64 bg-gray-900 shadow-xl overflow-y-auto flex-shrink-0` },
                            // Sidebar Header
                            React.createElement('div', { className: "p-6 flex items-center justify-between" },
                                React.createElement('div', { className: "flex items-center space-x-2" },
                                    React.createElement('img', {
                                        src: "https://gfivmnnysomfwrffybeh.supabase.co/storage/v1/object/public/logo/TERSYS_Logo.png",
                                        alt: "TERSYS Logo",
                                        className: "h-8"
                                    }),
                                    React.createElement('span', { className: "text-xl font-bold text-gray-200" }, "TERSYS")
                                ),
                                React.createElement('button', {
                                    onClick: () => setIsSidebarOpen(!isSidebarOpen),
                                    className: "text-gray-400 hover:text-white md:hidden"
                                }, React.createElement(LucideIcon, { name: "X" }))
                            ),
                            // Navigation Menu
                            React.createElement('nav', { className: "mt-8" },
                                React.createElement('ul', null,
                                    React.createElement('li', null,
                                        React.createElement('a', {
                                            href: "#",
                                            onClick: () => setCurrentPage('dashboard'),
                                            className: `flex items-center space-x-3 px-6 py-3 transition-colors duration-200 ${currentPage === 'dashboard' ? 'bg-gray-800 text-white' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`
                                        },
                                            React.createElement(LucideIcon, { name: "LayoutDashboard", className: "h-5 w-5" }),
                                            React.createElement('span', { className: "font-medium" }, "Dashboard")
                                        )
                                    ),
                                    userRole === 'administrador' && (
                                        React.createElement('li', null,
                                            React.createElement('a', {
                                                href: "#",
                                                onClick: () => setCurrentPage('branchManagement'),
                                                className: `flex items-center space-x-3 px-6 py-3 transition-colors duration-200 ${currentPage === 'branchManagement' ? 'bg-gray-800 text-white' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`
                                            },
                                                React.createElement(LucideIcon, { name: "Building", className: "h-5 w-5" }),
                                                React.createElement('span', { className: "font-medium" }, "Gerenciar Filiais")
                                            )
                                        )
                                    ),
                                    userRole === 'administrador' && (
                                        React.createElement('li', null,
                                            React.createElement('a', {
                                                href: "#",
                                                onClick: () => setCurrentPage('equipmentManagement'),
                                                className: `flex items-center space-x-3 px-6 py-3 transition-colors duration-200 ${currentPage === 'equipmentManagement' ? 'bg-gray-800 text-white' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`
                                            },
                                                React.createElement(LucideIcon, { name: "Truck", className: "h-5 w-5" }),
                                                React.createElement('span', { className: "font-medium" }, "Gerenciar Equipamentos")
                                            )
                                        )
                                    ),
                                    userRole === 'administrador' && (
                                        React.createElement('li', null,
                                            React.createElement('a', {
                                                href: "#",
                                                onClick: () => setCurrentPage('userManagement'),
                                                className: `flex items-center space-x-3 px-6 py-3 transition-colors duration-200 ${currentPage === 'userManagement' ? 'bg-gray-800 text-white' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`
                                            },
                                                React.createElement(LucideIcon, { name: "Users", className: "h-5 w-5" }),
                                                React.createElement('span', { className: "font-medium" }, "Gerenciar Usuários")
                                            )
                                    )),
                                    // Nova aba de Precificação
                                    React.createElement('li', null,
                                        React.createElement('a', {
                                            href: "#",
                                            onClick: () => setCurrentPage('pricing'),
                                            className: `flex items-center space-x-3 px-6 py-3 transition-colors duration-200 ${currentPage === 'pricing' ? 'bg-gray-800 text-white' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`
                                        },
                                            React.createElement(LucideIcon, { name: "DollarSign", className: "h-5 w-5" }),
                                            React.createElement('span', { className: "font-medium" }, "Precificação")
                                        )
                                    ),
                                    // Adicionar outras abas aqui
                                )
                            ),
                            // Logout Button
                            React.createElement('div', { className: "mt-auto p-4" },
                                React.createElement('a', {
                                    href: "#",
                                    onClick: handleLogout,
                                    className: "flex items-center space-x-3 px-6 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors duration-200"
                                },
                                    React.createElement(LucideIcon, { name: "LogOut", className: "h-5 w-5" }),
                                    React.createElement('span', { className: "font-medium" }, "Sair")
                                )
                            )
                        ),
                        // Main Content
                        React.createElement('div', { className: "flex-1 flex flex-col min-h-screen" },
                            // Main Header
                            React.createElement('header', { className: "bg-white shadow-sm h-16 flex items-center justify-between px-6 z-10" },
                                React.createElement('button', {
                                    onClick: () => setIsSidebarOpen(!isSidebarOpen),
                                    className: "text-gray-600 hover:text-gray-800 md:hidden"
                                }, React.createElement(LucideIcon, { name: "Menu" })),
                                React.createElement('div', { className: "flex items-center space-x-4 ml-auto" },
                                    React.createElement('div', { className: "text-gray-700 font-medium" }, `Olá, ${userId}!`),
                                    React.createElement('span', { className: "inline-block h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-semibold" }, userId[0].toUpperCase())
                                )
                            ),
                            // Content Area
                            React.createElement('main', { className: "flex-1 overflow-y-auto p-4 md:p-8" },
                                currentPage === 'pricing' && React.createElement(PricingPage, { userRole: userRole, showToast: showToast }),
                                // Renderiza QuickAccessMenu
                                currentPage === 'dashboard' && React.createElement(Dashboard, { userId: userId, showToast: showToast }),
                                currentPage === 'branchManagement' && userRole === 'administrador' && React.createElement(BranchManagement, { userId: userId, userRole: userRole, showToast: showToast }),
                                currentPage === 'equipmentManagement' && userRole === 'administrador' && React.createElement(EquipmentManagement, { userId: userId, showToast: showToast }),
                                currentPage === 'userManagement' && userRole === 'administrador' && React.createElement(UserManagement, { userId: userId, showToast: showToast }),
                                currentPage === 'outsourcingDistribution' && React.createElement(OutsourcingDistribution, { userId: userId, showToast: showToast, setCurrentPage: setCurrentPage }),
                                currentPage === 'branchTransfer' && React.createElement(BranchTransfer, { userId: userId, setCurrentPage: setCurrentPage, showToast: showToast }),
                                toastMessage && React.createElement(Toast, { message: toastMessage, type: toastType, onClose: clearToast })
                            )
                        )
                    )
                );
            }

            // ReactDOM.render(React.createElement(App, null), document.getElementById('root')); // This will be called after Supabase loads
        }; // End of window.onload
    </script>
</body>
</html>
