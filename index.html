<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERSYS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Slightly darker background for a professional feel */
        }
        /* Custom styles for select arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none; /* Remove default arrow */
        }
        select::-ms-expand {
            display: none; /* Hide arrow in IE/Edge */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #bdbdbd;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

    <script type="text/javascript">
        console.log("Script principal começando a carregar.");
        // Manual SVG Icons from Lucide React
        const icons = {
            FileText: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15 2z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',
            PlusCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>',
            Search: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            Building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 18h.01"/></svg>',
            Truck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M19 18h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-1V6a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>',
            UserCheck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="22 7 18 11 16 9"/></svg>',
            LogOut: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="11" y1="12" y2="12"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>',
            Menu: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>',
            X: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            ChevronDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>',
            ChevronUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="m18 15-6-6-6 6"/></svg>',
            LayoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>',
            CalendarDays: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>',
            User: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
            Users: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            Settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l-.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',
            ArrowLeftRight: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-arrow-left-right"><path d="M8 3L4 7L8 11"/><path d="M4 7h16"/><path d="M16 21l4-4l-4-4"/><path d="M20 17H4"/></svg>',
            ArrowLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>',
            MapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M12 18.3a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6z"/><path d="M12 2C7.58 2 4 5.58 4 10c0 5.57 8 12 8 12s8-6.43 8-12c0-4.42-3.58-8-8-8z"/></svg>',
            Factory: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-factory"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 9.86 2H7.14a2 2 0 0 0-1.66.9l-.82 1.2A2 2 0 0 1 4 6H2v14z"/><path d="M10 10v4"/><path d="M14 10v4"/><path d="M18 10v4"/><path d="M6 10v4"/></svg>',
            Edit: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
            Save: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>',
            Ban: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ban"><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></svg>',
            Banknote: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-banknote"><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01"/><path d="M18 12h.01"/></svg>'
        };
        // Componente de Mensagem/Toast
        function Toast({ message, type, onClose }) {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? '✔' : '✖'; // Simple icons for now

            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000); // Auto-close after 3 seconds
                return () => clearTimeout(timer);
            }, [onClose]);
            return (
                React.createElement('div', { className: `fixed bottom-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg flex items-center space-x-2 z-50 transition-all duration-300 ease-in-out transform translate-y-0 opacity-100` },
                    React.createElement('span', { className: "font-bold text-xl" }, icon),
                    React.createElement('p', null, message),
                    React.createElement('button', { onClick: onClose, className: "ml-4 font-bold opacity-75 hover:opacity-100 transition-opacity" }, 'X')
                )
            );
        }

        // Componente de Confirmação Modal
        function ConfirmationModal({ message, onConfirm, onCancel }) {
            return (
                React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fade-in" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 animate-scale-in" },
                        React.createElement('p', { className: "text-lg font-semibold text-gray-800 mb-6" }, message),
                        React.createElement('div', { className: "flex justify-center space-x-4" },
                            React.createElement('button', {
                                onClick: onConfirm,
                                className: "px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Confirmar"),
                            React.createElement('button', {
                                onClick: onCancel,
                                className: "px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Cancelar")
                        )
                    )
                )
            );
        }

        // Helper function to render Lucide icons
        function LucideIcon({ name, className }) {
            return React.createElement('span', {
                className: className,
                dangerouslySetInnerHTML: { __html: icons[name] || '' }
            });
        }

        // Wrap the entire React app rendering logic within window.onload
        window.onload = function() {
            console.log("window.onload disparado.");
            // Supabase client initialization
            // Substitua pelos seus dados reais do Supabase
            const SUPABASE_URL = 'https://gfivmnnysomfwrffybeh.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmaXZtbm55c29tZndyZmZ5YmVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTY3NjgsImV4cCI6MjA2ODg3Mjc2OH0.NxetXJoCLh4q9zAqn_olimziI3YP4MAJzB8ed4qf8cg';

            let supabase;

            // Function to initialize Supabase and render the App
            const initializeSupabaseAndRenderApp = () => {
                try {
                    console.log("Tentando inicializar o cliente Supabase...");
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Cliente Supabase inicializado com sucesso.");
                    ReactDOM.render(React.createElement(App, null), document.getElementById('root'));
                } catch (e) {
                    console.error("Erro ao inicializar o cliente Supabase:", e);
                    ReactDOM.render(
                        React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                            React.createElement('h1', null, 'Erro ao Inicializar Supabase'),
                            React.createElement('p', null, `Ocorreu um erro ao inicializar o cliente Supabase: ${e.message}. Verifique as suas credenciais e a configuração do projeto Supabase.`)
                        ),
                        document.getElementById('root')
                    );
                }
            };
            // Dynamically load Supabase library
            const supabaseScript = document.createElement('script');
            supabaseScript.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.0/dist/umd/supabase.min.js";
            supabaseScript.onload = () => {
                console.log("Biblioteca Supabase carregada com sucesso.");
                initializeSupabaseAndRenderApp();
            };
            supabaseScript.onerror = (error) => {
                console.error("Erro ao carregar a biblioteca Supabase:", error);
                ReactDOM.render(
                    React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                        React.createElement('h1', null, 'Erro ao Carregar Aplicação'),
                        React.createElement('p', null, 'A biblioteca Supabase não foi carregada. Por favor, verifique a sua ligação à internet ou o link CDN do Supabase no código HTML.')
                    ),
                    document.getElementById('root')
                );
            };
            document.head.appendChild(supabaseScript);

            // Global variable for app ID (from Canvas environment, if applicable, otherwise default)
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            // Componente para a tela de Login
            function LoginPage({ onLogin }) {
                const [username, setUsername] = React.useState('');
                const [password, setPassword] = React.useState('');
                const [error, setError] = React.useState('');
                const [isLoggingIn, setIsLoggingIn] = React.useState(false);
                const handleLogin = async (e) => {
                    e.preventDefault();
                    setIsLoggingIn(true);
                    setError('');

                    if (!username || !password) {
                        setError('Por favor, insira seu usuário e senha.');
                        setIsLoggingIn(false);
                        return;
                    }

                    await new Promise(resolve => setTimeout(resolve, 1000));
                    let role = null;

                    try {
                        console.log("Tentando login com username:", username.toLowerCase(), "e password:", password);
                        const { data, error: fetchError } = await supabase
                            .from('app_users')
                            .select('*')
                            .eq('username', username.toLowerCase())
                            .eq('password', password);
                        console.log("Resultado da consulta Supabase (data):", data);
                        console.log("Resultado da consulta Supabase (erro):", fetchError);
                        if (fetchError) {
                            console.error("Erro ao buscar usuário no Supabase:", fetchError);
                            setError("Erro ao autenticar. Por favor, tente novamente.");
                        } else if (data && data.length > 0) {
                            role = data[0].role;
                            // Salvar informações do usuário no localStorage após login bem-sucedido
                            localStorage.setItem('userRole', role);
                            localStorage.setItem('userId', username.toLowerCase()); // Usar o username como userId
                        } else {
                            setError('Usuário ou senha inválidos.');
                        }
                    } catch (e) {
                        console.error("Erro inesperado ao buscar usuário no Supabase:", e);
                        setError("Erro ao autenticar. Por favor, tente novamente.");
                    }


                    if (role) {
                        onLogin(role, username.toLowerCase());
                    } else {
                        if (!error) {
                            setError('Usuário ou senha inválidos.');
                        }
                    }
                    setIsLoggingIn(false);
                };

                return (
                    React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100 font-sans" },
                        React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-lg w-full max-w-md" },
                            // Logo TERSYS
                            React.createElement('div', { className: "flex flex-col items-center justify-center mb-6" },
                                React.createElement('img', {
                                    src: "https://gfivmnnysomfwrffybeh.supabase.co/storage/v1/object/public/logo//LOGO_TERSYS-removebg-preview%20(1).png",
                                    alt: "TERSYS Logo",
                                    className: "h-32 w-auto mb-4" // Ajuste o tamanho conforme necessário
                                })
                            ),
                            error && (
                                React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                    React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                    React.createElement('span', { className: "block sm:inline" }, " ", error)
                                )
                            ),
                            React.createElement('form', { onSubmit: handleLogin },
                                React.createElement('div', { className: "mb-4" },
                                    React.createElement('label', { htmlFor: "username", className: "block text-sm font-medium text-gray-700 mb-1" }, "Usuário"),
                                    React.createElement('input', {
                                        type: "text",
                                        id: "username",
                                        value: username,
                                        onChange: (e) => { setUsername(e.target.value); setError(''); },
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                        placeholder: "Digite seu usuário",
                                        required: true,
                                        disabled: isLoggingIn
                                    })
                                ),
                                React.createElement('div', { className: "mb-6" },
                                    React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                                    React.createElement('input', {
                                        type: "password",
                                        id: "password",
                                        value: password,
                                        onChange: (e) => setPassword(e.target.value),
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                        placeholder: "Digite sua senha",
                                        required: true,
                                        disabled: isLoggingIn
                                    })
                                ),
                                React.createElement('button', {
                                    type: "submit",
                                    className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoggingIn
                                },
                                    isLoggingIn ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: "UserCheck", className: "mr-2 h-5 w-5" })
                                    ),
                                    isLoggingIn ? 'Entrando...' : 'Entrar'
                                )
                            )
                        )
                    )
                );
            }

            // Componente para Gerenciamento de Filiais
            function BranchManagement({ userId, userRole, showToast }) {
                const [newBranchName, setNewBranchName] = React.useState('');
                const [branches, setBranches] = React.useState([]);
                const [responsibleInput, setResponsibleInput] = React.useState("");
                const [error, setError] = React.useState(null);
                const [isLoading, setIsLoading] = React.useState(false);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [branchToDelete, setBranchToDelete] = React.useState(null);
                const [editingBranch, setEditingBranch] = React.useState(null);
                const [originalBranch, setOriginalBranch] = React.useState(null);
                const [availableSupervisors, setAvailableSupervisors] = React.useState([]);

                React.useEffect(() => {
                    if (!userId || !userRole) return;

                    const fetchBranchesAndSupervisors = async () => {
                        setIsLoading(true);

                        // Fetch filiais
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data: branchesData, error: fetchBranchesError } = await query;

                        if (fetchBranchesError) {
                            console.error("Erro ao buscar filiais:", fetchBranchesError);
                            setError("Erro ao carregar filiais.");
                            showToast("Erro ao carregar filiais.", "error");
                        } else {
                            setBranches(branchesData);
                        }

                        // Fetch supervisors
                        const { data: supervisorsData, error: fetchSupervisorsError } = await supabase
                            .from('app_users')
                            .select('username')
                            .eq('role', 'supervisor')
                            .order('username', { ascending: true });
                        if (fetchSupervisorsError) {
                            console.error("Erro ao buscar supervisores:", fetchSupervisorsError);
                            setError("Erro ao carregar supervisores.");
                            showToast("Erro ao carregar supervisores.", "error");
                        } else {
                            setAvailableSupervisors(supervisorsData.map(u => u.username));
                        }
                        setIsLoading(false);
                    };
                    fetchBranchesAndSupervisors();
                }, [userId, userRole, showToast]);
                const handleAddBranch = async (e) => {
                    e.preventDefault();
                    const trimmedBranchName = newBranchName.trim();
                    if (!trimmedBranchName) {
                        setError("O nome da filial não pode estar vazio.");
                        showToast("O nome da filial não pode estar vazio.", "error");
                        return;
                    }
                    if (!responsibleInput.trim()) {
                        setError("Por favor, selecione um responsável para a nova filial.");
                        showToast("Selecione um responsável.", "error");
                        return;
                    }
                    setIsLoading(true);
                    try {
                        const { data: existingBranches, error: checkError } = await supabase
                            .from('filiais')
                            .select('id')
                            .ilike('name', trimmedBranchName);
                        if (checkError) throw checkError;
                        if (existingBranches && existingBranches.length > 0) {
                            setError("Já existe uma filial com este nome. Por favor, escolha outro.");
                            showToast("Filial já existe.", "error");
                            setIsLoading(false);
                            return;
                        }
                        const { error: insertError } = await supabase
                            .from('filiais')
                            .insert([
                                { name: trimmedBranchName, created_by_username: userId, responsible: responsibleInput.trim() },
                            ]);
                        if (insertError) throw insertError;
                        setNewBranchName('');
                        setResponsibleInput("");
                        setError(null);
                        showToast("Filial adicionada com sucesso!", "success");
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data } = await query;
                        setBranches(data);
                    } catch (e) {
                        console.error("Erro ao adicionar filial:", e);
                        setError("Erro ao adicionar filial.");
                        showToast("Erro ao adicionar filial.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };
                const handleEditClick = (branch) => {
                    setEditingBranch({ ...branch });
                    setOriginalBranch({ ...branch });
                };
                const handleCancelEdit = () => {
                    setEditingBranch(null);
                    setOriginalBranch(null);
                    setBranches(prevBranches => prevBranches.map(b => b.id === originalBranch.id ? originalBranch : b));
                };
                const handleUpdateBranch = async () => {
                    if (!editingBranch) return;
                    const trimmedBranchName = editingBranch.name.trim();
                    if (!trimmedBranchName) {
                        setError("O nome da filial não pode estar vazio.");
                        showToast("O nome da filial não pode estar vazio.", "error");
                        return;
                    }
                    if (!editingBranch.responsible.trim()) {
                        setError("Por favor, selecione um responsável para a filial.");
                        showToast("Selecione um responsável.", "error");
                        return;
                    }
                    setIsLoading(true);
                    try {
                        const { data: existingBranches, error: checkError } = await supabase
                            .from('filiais')
                            .select('id')
                            .ilike('name', trimmedBranchName)
                            .neq('id', editingBranch.id);
                        if (checkError) throw checkError;
                        if (existingBranches && existingBranches.length > 0) {
                            setError("Já existe outra filial com este nome. Por favor, escolha outro.");
                            showToast("Nome de filial duplicado.", "error");
                            setIsLoading(false);
                            return;
                        }
                        const { error: updateError } = await supabase
                            .from('filiais')
                            .update({ name: trimmedBranchName, responsible: editingBranch.responsible.trim() })
                            .eq('id', editingBranch.id);
                        if (updateError) throw updateError;
                        showToast("Filial atualizada com sucesso!", "success");
                        setEditingBranch(null);
                        setOriginalBranch(null);
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data } = await query;
                        setBranches(data);
                    } catch (e) {
                        console.error("Erro ao atualizar filial:", e);
                        setError("Erro ao atualizar filial.");
                        showToast("Erro ao atualizar filial.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };
                const handleFieldChange = (e, fieldName) => {
                    setEditingBranch(prev => ({ ...prev, [fieldName]: e.target.value }));
                };
                const confirmDeleteBranch = (branch) => {
                    setBranchToDelete(branch);
                    setShowConfirmModal(true);
                };
                const handleDeleteBranch = async () => {
                    if (!branchToDelete) return;
                    setIsLoading(true);
                    setShowConfirmModal(false);
                    try {
                        const { error: deleteError } = await supabase.from('filiais').delete().eq('id', branchToDelete.id);
                        if (deleteError) throw deleteError;
                        showToast("Filial excluída com sucesso!", "success");
                        const query = supabase.from('filiais').select('*').order('created_at', { ascending: false });
                        if (userRole === 'supervisor') {
                            query.eq('responsible', userId);
                        }
                        const { data } = await query;
                        setBranches(data);
                    } catch (e) {
                        console.error("Erro ao excluir filial:", e);
                        showToast("Erro ao excluir filial.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };
                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        showConfirmModal && React.createElement(ConfirmationModal, {
                            message: "Tem certeza que deseja excluir esta filial?",
                            onConfirm: handleDeleteBranch,
                            onCancel: () => setShowConfirmModal(false)
                        }),
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Gerenciamento de Filiais"),
                                userRole === 'administrador' && React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => { } // Não faz nada, é apenas visual
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    "Adicionar Filial"
                                )
                            ),
                            userRole === 'administrador' && React.createElement('form', { onSubmit: handleAddBranch, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4" },
                                    React.createElement('div', { className: "w-full md:flex-1" },
                                        React.createElement('label', { htmlFor: "newBranchName", className: "block text-sm font-medium text-gray-700" }, "Nome da Nova Filial"),
                                        React.createElement('input', {
                                            type: "text",
                                            id: "newBranchName",
                                            value: newBranchName,
                                            onChange: (e) => setNewBranchName(e.target.value),
                                            placeholder: "Nome da filial",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', { className: "w-full md:flex-1" },
                                        React.createElement('label', { htmlFor: "responsible", className: "block text-sm font-medium text-gray-700" }, "Responsável"),
                                        React.createElement('select', {
                                            id: "responsible",
                                            value: responsibleInput,
                                            onChange: (e) => setResponsibleInput(e.target.value),
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione um responsável"),
                                            availableSupervisors.map(supervisor => React.createElement('option', { key: supervisor, value: supervisor }, supervisor))
                                        )
                                    ),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: "w-full md:w-auto mt-4 md:mt-0 px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md",
                                        disabled: isLoading
                                    }, "Adicionar")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Nome da Filial"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Responsável"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Criado por"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data de Criação"),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: userRole === 'administrador' ? 5 : 4, className: "text-center py-4" }, "Carregando..."))
                                        ) : branches.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: userRole === 'administrador' ? 5 : 4, className: "text-center py-4 text-gray-500" }, "Nenhuma filial encontrada."))
                                        ) : (
                                            branches.map(branch => (
                                                React.createElement('tr', { key: branch.id, className: "hover:bg-gray-50" },
                                                    editingBranch && editingBranch.id === branch.id ? (
                                                        React.createElement(React.Fragment, null,
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', {
                                                                    type: "text",
                                                                    value: editingBranch.name,
                                                                    onChange: (e) => handleFieldChange(e, 'name'),
                                                                    className: "w-full p-2 border rounded-md"
                                                                })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('select', {
                                                                    value: editingBranch.responsible,
                                                                    onChange: (e) => handleFieldChange(e, 'responsible'),
                                                                    className: "w-full p-2 border rounded-md"
                                                                },
                                                                    availableSupervisors.map(supervisor => React.createElement('option', { key: supervisor, value: supervisor }, supervisor))
                                                                )
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, branch.created_by_username),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, new Date(branch.created_at).toLocaleDateString()),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                                React.createElement('div', { className: "flex space-x-2 justify-end" },
                                                                    React.createElement('button', { onClick: handleUpdateBranch, className: "text-green-600 hover:text-green-800 transition duration-150 ease-in-out" },
                                                                        React.createElement(LucideIcon, { name: "Save", className: "w-5 h-5" })
                                                                    ),
                                                                    React.createElement('button', { onClick: handleCancelEdit, className: "text-red-600 hover:text-red-800 transition duration-150 ease-in-out" },
                                                                        React.createElement(LucideIcon, { name: "Ban", className: "w-5 h-5" })
                                                                    )
                                                                )
                                                            )
                                                        )
                                                    ) : (
                                                        React.createElement(React.Fragment, null,
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('p', { className: "text-gray-900 whitespace-no-wrap" }, branch.name)
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('p', { className: "text-gray-900 whitespace-no-wrap" }, branch.responsible || '-')
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('p', { className: "text-gray-900 whitespace-no-wrap" }, branch.created_by_username)
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('p', { className: "text-gray-900 whitespace-no-wrap" }, new Date(branch.created_at).toLocaleDateString())
                                                            ),
                                                            userRole === 'administrador' && React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                                React.createElement('div', { className: "flex space-x-2 justify-end" },
                                                                    React.createElement('button', { onClick: () => handleEditClick(branch), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                                        React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                                    ),
                                                                    React.createElement('button', { onClick: () => confirmDeleteBranch(branch), className: "text-red-600 hover:text-red-800 transition duration-150 ease-in-out" },
                                                                        React.createElement(LucideIcon, { name: "Trash2", className: "w-5 h-5" })
                                                                    )
                                                                )
                                                            )
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente para Gerenciamento de Equipamentos
            function EquipmentManagement({ userId, showToast }) {
                const [equipmentData, setEquipmentData] = React.useState({
                    name: '',
                    type: '',
                    filial: '',
                    status: '',
                    km: ''
                });
                const [editingEquipment, setEditingEquipment] = React.useState(null);
                const [equipments, setEquipments] = React.useState([]);
                const [branches, setBranches] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [equipmentToDelete, setEquipmentToDelete] = React.useState(null);

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        const { data: equipmentList, error: equipmentError } = await supabase
                            .from('equipamentos')
                            .select('*')
                            .order('created_at', { ascending: false });

                        if (equipmentError) {
                            throw equipmentError;
                        }

                        const { data: branchList, error: branchError } = await supabase
                            .from('filiais')
                            .select('name')
                            .order('name', { ascending: true });

                        if (branchError) {
                            throw branchError;
                        }

                        setEquipments(equipmentList);
                        setBranches(branchList.map(b => b.name));
                    } catch (e) {
                        console.error("Erro ao buscar dados:", e);
                        showToast("Erro ao carregar dados.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleFieldChange = (e, field) => {
                    const value = e.target.value;
                    if (editingEquipment) {
                        setEditingEquipment(prev => ({ ...prev, [field]: value }));
                    } else {
                        setEquipmentData(prev => ({ ...prev, [field]: value }));
                    }
                };

                const handleAddOrUpdateEquipment = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);

                    // Verifica se todos os campos estão preenchidos, exceto para edição onde um campo pode não ser alterado
                    const dataToSave = editingEquipment ? editingEquipment : equipmentData;
                    if (!dataToSave.name || !dataToSave.type || !dataToSave.filial || !dataToSave.status || !dataToSave.km) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        setIsLoading(false);
                        return;
                    }

                    try {
                        if (editingEquipment) {
                            const { error: updateError } = await supabase
                                .from('equipamentos')
                                .update(dataToSave)
                                .eq('id', editingEquipment.id);

                            if (updateError) throw updateError;
                            showToast("Equipamento atualizado com sucesso!", "success");
                            setEditingEquipment(null);
                        } else {
                            const { error: insertError } = await supabase
                                .from('equipamentos')
                                .insert([{ ...equipmentData, created_by_username: userId }]);

                            if (insertError) throw insertError;
                            showToast("Equipamento adicionado com sucesso!", "success");
                            setEquipmentData({
                                name: '',
                                type: '',
                                filial: '',
                                status: '',
                                km: ''
                            });
                        }
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao salvar equipamento:", e);
                        showToast("Erro ao salvar equipamento.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const confirmDeleteEquipment = (equipment) => {
                    setEquipmentToDelete(equipment);
                    setShowConfirmModal(true);
                };

                const handleDeleteEquipment = async () => {
                    if (!equipmentToDelete) return;
                    setIsLoading(true);
                    setShowConfirmModal(false);
                    try {
                        const { error: deleteError } = await supabase
                            .from('equipamentos')
                            .delete()
                            .eq('id', equipmentToDelete.id);

                        if (deleteError) throw deleteError;
                        showToast("Equipamento excluído com sucesso!", "success");
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao excluir equipamento:", e);
                        showToast("Erro ao excluir equipamento.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        showConfirmModal && React.createElement(ConfirmationModal, {
                            message: "Tem certeza que deseja excluir este equipamento?",
                            onConfirm: handleDeleteEquipment,
                            onCancel: () => setShowConfirmModal(false)
                        }),
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Gerenciamento de Equipamentos"),
                                React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => { } // Placeholder
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    "Adicionar Equipamento"
                                )
                            ),
                            React.createElement('form', { onSubmit: handleAddOrUpdateEquipment, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4" },
                                    React.createElement('div', { className: "col-span-1" },
                                        React.createElement('label', { htmlFor: "name", className: "block text-sm font-medium text-gray-700" }, "Nome"),
                                        React.createElement('input', {
                                            type: "text",
                                            id: "name",
                                            value: editingEquipment ? editingEquipment.name : equipmentData.name,
                                            onChange: (e) => handleFieldChange(e, 'name'),
                                            placeholder: "Nome do equipamento",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', { className: "col-span-1" },
                                        React.createElement('label', { htmlFor: "type", className: "block text-sm font-medium text-gray-700" }, "Tipo"),
                                        React.createElement('select', {
                                            id: "type",
                                            value: editingEquipment ? editingEquipment.type : equipmentData.type,
                                            onChange: (e) => handleFieldChange(e, 'type'),
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione o tipo"),
                                            ['Carreta', 'Caminhão', 'Utilitário'].map(type => React.createElement('option', { key: type, value: type }, type))
                                        )
                                    ),
                                    React.createElement('div', { className: "col-span-1" },
                                        React.createElement('label', { htmlFor: "filial", className: "block text-sm font-medium text-gray-700" }, "Filial"),
                                        React.createElement('select', {
                                            id: "filial",
                                            value: editingEquipment ? editingEquipment.filial : equipmentData.filial,
                                            onChange: (e) => handleFieldChange(e, 'filial'),
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione a filial"),
                                            branches.map(branch => React.createElement('option', { key: branch, value: branch }, branch))
                                        )
                                    ),
                                    React.createElement('div', { className: "col-span-1" },
                                        React.createElement('label', { htmlFor: "status", className: "block text-sm font-medium text-gray-700" }, "Status"),
                                        React.createElement('select', {
                                            id: "status",
                                            value: editingEquipment ? editingEquipment.status : equipmentData.status,
                                            onChange: (e) => handleFieldChange(e, 'status'),
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione o status"),
                                            ['Ativo', 'Inativo', 'Manutenção'].map(status => React.createElement('option', { key: status, value: status }, status))
                                        )
                                    ),
                                    React.createElement('div', { className: "col-span-1" },
                                        React.createElement('label', { htmlFor: "km", className: "block text-sm font-medium text-gray-700" }, "KM Atual"),
                                        React.createElement('input', {
                                            type: "number",
                                            id: "km",
                                            value: editingEquipment ? editingEquipment.km : equipmentData.km,
                                            onChange: (e) => handleFieldChange(e, 'km'),
                                            placeholder: "KM",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4 space-x-2" },
                                    editingEquipment && React.createElement('button', {
                                        type: "button",
                                        onClick: () => {
                                            setEditingEquipment(null);
                                            setEquipmentData({ name: '', type: '', filial: '', status: '', km: '' });
                                        },
                                        className: "px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-150 ease-in-out shadow-md"
                                    }, "Cancelar"),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: `px-6 py-2 ${editingEquipment ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'} text-white rounded-md transition duration-150 ease-in-out shadow-md`,
                                        disabled: isLoading
                                    }, editingEquipment ? "Atualizar" : "Adicionar")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Nome"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Tipo"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Status"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "KM"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 6, className: "text-center py-4" }, "Carregando..."))
                                        ) : equipments.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 6, className: "text-center py-4 text-gray-500" }, "Nenhum equipamento encontrado."))
                                        ) : (
                                            equipments.map(eq => (
                                                React.createElement('tr', { key: eq.id, className: "hover:bg-gray-50" },
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, eq.name),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, eq.type),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, eq.filial),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, eq.status),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, eq.km),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                        React.createElement('div', { className: "flex space-x-2 justify-end" },
                                                            React.createElement('button', { onClick: () => setEditingEquipment(eq), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                                React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                            ),
                                                            React.createElement('button', { onClick: () => confirmDeleteEquipment(eq), className: "text-red-600 hover:text-red-800 transition duration-150 ease-in-out" },
                                                                React.createElement(LucideIcon, { name: "Trash2", className: "w-5 h-5" })
                                                            )
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente para Gerenciamento de Usuários
            function UserManagement({ userId, showToast }) {
                const [users, setUsers] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [newUser, setNewUser] = React.useState({ username: '', password: '', role: 'usuario' });
                const [editingUser, setEditingUser] = React.useState(null);
                const [showAddForm, setShowAddForm] = React.useState(false);

                React.useEffect(() => {
                    fetchUsers();
                }, []);

                const fetchUsers = async () => {
                    setIsLoading(true);
                    try {
                        const { data, error } = await supabase
                            .from('app_users')
                            .select('*')
                            .order('created_at', { ascending: false });
                        if (error) throw error;
                        setUsers(data);
                    } catch (e) {
                        console.error("Erro ao buscar usuários:", e);
                        showToast("Erro ao carregar usuários.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleAddUser = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);
                    if (!newUser.username || !newUser.password || !newUser.role) {
                        showToast("Preencha todos os campos para adicionar o usuário.", "error");
                        setIsLoading(false);
                        return;
                    }

                    try {
                        const { data, error } = await supabase
                            .from('app_users')
                            .insert([{ ...newUser, created_by_username: userId, username: newUser.username.toLowerCase() }])
                            .select();
                        if (error) throw error;
                        showToast("Usuário adicionado com sucesso!", "success");
                        setNewUser({ username: '', password: '', role: 'usuario' });
                        setShowAddForm(false);
                        fetchUsers();
                    } catch (e) {
                        console.error("Erro ao adicionar usuário:", e);
                        showToast("Erro ao adicionar usuário.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleUpdateUser = async (e) => {
                    e.preventDefault();
                    if (!editingUser) return;
                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('app_users')
                            .update({ password: editingUser.password, role: editingUser.role })
                            .eq('id', editingUser.id);
                        if (error) throw error;
                        showToast("Usuário atualizado com sucesso!", "success");
                        setEditingUser(null);
                        fetchUsers();
                    } catch (e) {
                        console.error("Erro ao atualizar usuário:", e);
                        showToast("Erro ao atualizar usuário.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleEditClick = (user) => {
                    setEditingUser({ ...user });
                    setShowAddForm(false); // Esconde o formulário de adição ao editar
                };

                const handleDeleteUser = async (userId) => {
                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('app_users')
                            .delete()
                            .eq('id', userId);
                        if (error) throw error;
                        showToast("Usuário excluído com sucesso!", "success");
                        fetchUsers();
                    } catch (e) {
                        console.error("Erro ao excluir usuário:", e);
                        showToast("Erro ao excluir usuário.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };
                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Gerenciamento de Usuários"),
                                React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => {
                                        setShowAddForm(!showAddForm);
                                        setEditingUser(null);
                                    }
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    "Adicionar Usuário"
                                )
                            ),
                            showAddForm && React.createElement('form', { onSubmit: handleAddUser, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "username", className: "block text-sm font-medium text-gray-700" }, "Usuário"),
                                        React.createElement('input', {
                                            type: "text",
                                            id: "username",
                                            value: newUser.username,
                                            onChange: (e) => setNewUser({ ...newUser, username: e.target.value }),
                                            placeholder: "Nome de usuário",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700" }, "Senha"),
                                        React.createElement('input', {
                                            type: "password",
                                            id: "password",
                                            value: newUser.password,
                                            onChange: (e) => setNewUser({ ...newUser, password: e.target.value }),
                                            placeholder: "Senha",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "role", className: "block text-sm font-medium text-gray-700" }, "Função"),
                                        React.createElement('select', {
                                            id: "role",
                                            value: newUser.role,
                                            onChange: (e) => setNewUser({ ...newUser, role: e.target.value }),
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "usuario" }, "Usuário"),
                                            React.createElement('option', { value: "supervisor" }, "Supervisor"),
                                            React.createElement('option', { value: "administrador" }, "Administrador")
                                        )
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4" },
                                    React.createElement('button', {
                                        type: "submit",
                                        className: "px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md",
                                        disabled: isLoading
                                    }, "Adicionar")
                                )
                            ),
                            editingUser && React.createElement('form', { onSubmit: handleUpdateUser, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('h2', { className: "text-xl font-bold text-gray-700 mb-4" }, `Editando Usuário: ${editingUser.username}`),
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "editPassword", className: "block text-sm font-medium text-gray-700" }, "Nova Senha"),
                                        React.createElement('input', {
                                            type: "password",
                                            id: "editPassword",
                                            value: editingUser.password,
                                            onChange: (e) => setEditingUser({ ...editingUser, password: e.target.value }),
                                            placeholder: "Nova senha",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "editRole", className: "block text-sm font-medium text-gray-700" }, "Nova Função"),
                                        React.createElement('select', {
                                            id: "editRole",
                                            value: editingUser.role,
                                            onChange: (e) => setEditingUser({ ...editingUser, role: e.target.value }),
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "usuario" }, "Usuário"),
                                            React.createElement('option', { value: "supervisor" }, "Supervisor"),
                                            React.createElement('option', { value: "administrador" }, "Administrador")
                                        )
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4 space-x-2" },
                                    React.createElement('button', {
                                        type: "button",
                                        onClick: () => setEditingUser(null),
                                        className: "px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-150 ease-in-out shadow-md"
                                    }, "Cancelar"),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: "px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md",
                                        disabled: isLoading
                                    }, "Atualizar")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Usuário"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Função"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Criado por"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data de Criação"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: "text-center py-4" }, "Carregando..."))
                                        ) : users.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: "text-center py-4 text-gray-500" }, "Nenhum usuário encontrado."))
                                        ) : (
                                            users.map(user => (
                                                React.createElement('tr', { key: user.id, className: "hover:bg-gray-50" },
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, user.username),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, user.role),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, user.created_by_username),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, new Date(user.created_at).toLocaleDateString()),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                        React.createElement('div', { className: "flex space-x-2 justify-end" },
                                                            React.createElement('button', { onClick: () => handleEditClick(user), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                                React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                            ),
                                                            React.createElement('button', { onClick: () => handleDeleteUser(user.id), className: "text-red-600 hover:text-red-800 transition duration-150 ease-in-out" },
                                                                React.createElement(LucideIcon, { name: "Trash2", className: "w-5 h-5" })
                                                            )
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente para a aba de Distribuição de Terceiros
            function OutsourcingDistribution({ userId, showToast, setCurrentPage }) {
                const [distribuicoes, setDistribuicoes] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [editingDistribuicao, setEditingDistribuicao] = React.useState(null);

                React.useEffect(() => {
                    fetchDistribuicoes();
                }, []);

                const fetchDistribuicoes = async () => {
                    setIsLoading(true);
                    try {
                        const { data, error } = await supabase
                            .from('distribuicao_terceiros')
                            .select('*')
                            .order('created_at', { ascending: false });
                        if (error) throw error;
                        setDistribuicoes(data);
                    } catch (e) {
                        console.error("Erro ao buscar distribuições:", e);
                        showToast("Erro ao carregar distribuições.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleEditClick = (distribuicao) => {
                    setEditingDistribuicao({ ...distribuicao });
                };

                const handleFieldChange = (e, field) => {
                    setEditingDistribuicao(prev => ({ ...prev, [field]: e.target.value }));
                };

                const handleUpdate = async () => {
                    if (!editingDistribuicao) return;
                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('distribuicao_terceiros')
                            .update({
                                filial: editingDistribuicao.filial,
                                km_inicial: editingDistribuicao.km_inicial,
                                km_final: editingDistribuicao.km_final,
                                observacoes: editingDistribuicao.observacoes,
                                data: editingDistribuicao.data,
                                placa: editingDistribuicao.placa,
                                nome_motorista: editingDistribuicao.nome_motorista,
                            })
                            .eq('id', editingDistribuicao.id);
                        if (error) throw error;
                        showToast("Distribuição atualizada com sucesso!", "success");
                        setEditingDistribuicao(null);
                        fetchDistribuicoes();
                    } catch (e) {
                        console.error("Erro ao atualizar distribuição:", e);
                        showToast("Erro ao atualizar distribuição.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleCancelEdit = () => {
                    setEditingDistribuicao(null);
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Distribuição de Terceiros"),
                                React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => setCurrentPage('addOutsourcingDistribution')
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    "Adicionar Distribuição"
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "KM Inicial"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "KM Final"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Observações"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Placa"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Motorista"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 8, className: "text-center py-4" }, "Carregando..."))
                                        ) : distribuicoes.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 8, className: "text-center py-4 text-gray-500" }, "Nenhuma distribuição encontrada."))
                                        ) : (
                                            distribuicoes.map(dist => (
                                                React.createElement('tr', { key: dist.id, className: "hover:bg-gray-50" },
                                                    editingDistribuicao && editingDistribuicao.id === dist.id ? (
                                                        React.createElement(React.Fragment, null,
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "text", value: editingDistribuicao.filial, onChange: e => handleFieldChange(e, 'filial'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "number", value: editingDistribuicao.km_inicial, onChange: e => handleFieldChange(e, 'km_inicial'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "number", value: editingDistribuicao.km_final, onChange: e => handleFieldChange(e, 'km_final'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "text", value: editingDistribuicao.observacoes, onChange: e => handleFieldChange(e, 'observacoes'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "date", value: editingDistribuicao.data, onChange: e => handleFieldChange(e, 'data'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "text", value: editingDistribuicao.placa, onChange: e => handleFieldChange(e, 'placa'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" },
                                                                React.createElement('input', { type: "text", value: editingDistribuicao.nome_motorista, onChange: e => handleFieldChange(e, 'nome_motorista'), className: "w-full p-2 border rounded-md" })
                                                            ),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                                React.createElement('div', { className: "flex space-x-2 justify-end" },
                                                                    React.createElement('button', { onClick: handleUpdate, className: "text-green-600 hover:text-green-800 transition duration-150 ease-in-out" },
                                                                        React.createElement(LucideIcon, { name: "Save", className: "w-5 h-5" })
                                                                    ),
                                                                    React.createElement('button', { onClick: handleCancelEdit, className: "text-red-600 hover:text-red-800 transition duration-150 ease-in-out" },
                                                                        React.createElement(LucideIcon, { name: "Ban", className: "w-5 h-5" })
                                                                    )
                                                                )
                                                            )
                                                        )
                                                    ) : (
                                                        React.createElement(React.Fragment, null,
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.filial),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.km_inicial),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.km_final),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.observacoes),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.data),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.placa),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, dist.nome_motorista),
                                                            React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                                React.createElement('button', { onClick: () => handleEditClick(dist), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                                    React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                                )
                                                            )
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente para a aba de Transferência de Filiais
            function BranchTransfer({ userId, setCurrentPage, showToast }) {
                const [transfers, setTransfers] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [branches, setBranches] = React.useState([]);
                const [equipments, setEquipments] = React.useState([]);
                const [form, setForm] = React.useState({
                    filial_origem: '',
                    filial_destino: '',
                    equipamento_id: '',
                    data_transferencia: '',
                    observacoes: ''
                });

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        const { data: transferList, error: transferError } = await supabase
                            .from('transferencias_filiais')
                            .select('*, equipamentos!inner(name), filiais_origem:filiais!transferencias_filiais_filial_origem_fkey(name), filiais_destino:filiais!transferencias_filiais_filial_destino_fkey(name)')
                            .order('created_at', { ascending: false });
                        if (transferError) throw transferError;
                        setTransfers(transferList);

                        const { data: branchList, error: branchError } = await supabase
                            .from('filiais')
                            .select('id, name');
                        if (branchError) throw branchError;
                        setBranches(branchList);

                        const { data: equipmentList, error: equipmentError } = await supabase
                            .from('equipamentos')
                            .select('id, name');
                        if (equipmentError) throw equipmentError;
                        setEquipments(equipmentList);
                    } catch (e) {
                        console.error("Erro ao buscar dados:", e);
                        showToast("Erro ao carregar dados.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleChange = (e) => {
                    const { name, value } = e.target;
                    setForm(prev => ({ ...prev, [name]: value }));
                };

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    if (!form.filial_origem || !form.filial_destino || !form.equipamento_id || !form.data_transferencia) {
                        showToast("Por favor, preencha todos os campos obrigatórios.", "error");
                        return;
                    }
                    if (form.filial_origem === form.filial_destino) {
                        showToast("A filial de origem não pode ser a mesma que a de destino.", "error");
                        return;
                    }
                    setIsLoading(true);
                    try {
                        const { error: insertError } = await supabase
                            .from('transferencias_filiais')
                            .insert([{ ...form, created_by_username: userId }]);
                        if (insertError) throw insertError;

                        // Atualiza a filial do equipamento
                        const { error: updateError } = await supabase
                            .from('equipamentos')
                            .update({ filial: branches.find(b => b.id === parseInt(form.filial_destino)).name })
                            .eq('id', parseInt(form.equipamento_id));
                        if (updateError) throw updateError;

                        showToast("Transferência registrada e equipamento atualizado com sucesso!", "success");
                        setForm({
                            filial_origem: '',
                            filial_destino: '',
                            equipamento_id: '',
                            data_transferencia: '',
                            observacoes: ''
                        });
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao registrar transferência:", e);
                        showToast("Erro ao registrar transferência.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Transferência de Filiais"),
                                React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => { } // Não faz nada, é apenas visual
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    "Nova Transferência"
                                )
                            ),
                            React.createElement('form', { onSubmit: handleSubmit, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "equipamento_id", className: "block text-sm font-medium text-gray-700" }, "Equipamento"),
                                        React.createElement('select', {
                                            name: "equipamento_id",
                                            value: form.equipamento_id,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione um equipamento"),
                                            equipments.map(eq => React.createElement('option', { key: eq.id, value: eq.id }, eq.name))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "filial_origem", className: "block text-sm font-medium text-gray-700" }, "Filial de Origem"),
                                        React.createElement('select', {
                                            name: "filial_origem",
                                            value: form.filial_origem,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione a filial de origem"),
                                            branches.map(branch => React.createElement('option', { key: branch.id, value: branch.id }, branch.name))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "filial_destino", className: "block text-sm font-medium text-gray-700" }, "Filial de Destino"),
                                        React.createElement('select', {
                                            name: "filial_destino",
                                            value: form.filial_destino,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione a filial de destino"),
                                            branches.map(branch => React.createElement('option', { key: branch.id, value: branch.id }, branch.name))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "data_transferencia", className: "block text-sm font-medium text-gray-700" }, "Data da Transferência"),
                                        React.createElement('input', {
                                            type: "date",
                                            name: "data_transferencia",
                                            value: form.data_transferencia,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', { className: "col-span-1 md:col-span-2 lg:col-span-3" },
                                        React.createElement('label', { htmlFor: "observacoes", className: "block text-sm font-medium text-gray-700" }, "Observações"),
                                        React.createElement('textarea', {
                                            name: "observacoes",
                                            value: form.observacoes,
                                            onChange: handleChange,
                                            rows: "3",
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                                        })
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4" },
                                    React.createElement('button', {
                                        type: "submit",
                                        className: "px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md",
                                        disabled: isLoading
                                    }, "Registrar Transferência")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Equipamento"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial de Origem"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial de Destino"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data da Transferência"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Observações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: "text-center py-4" }, "Carregando..."))
                                        ) : transfers.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: "text-center py-4 text-gray-500" }, "Nenhuma transferência encontrada."))
                                        ) : (
                                            transfers.map(transfer => (
                                                React.createElement('tr', { key: transfer.id, className: "hover:bg-gray-50" },
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, transfer.equipamentos.name),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, transfer.filiais_origem.name),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, transfer.filiais_destino.name),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, new Date(transfer.data_transferencia).toLocaleDateString()),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, transfer.observacoes)
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // NOVOS COMPONENTES PARA A ABA DE PRECIFICACAO
            // Componente de Precificação de Deslocamentos
            function DisplacementPricing({ userId, userRole, showToast }) {
                const [displacements, setDisplacements] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [isFormVisible, setIsFormVisible] = React.useState(false);
                const [form, setForm] = React.useState({
                    tipo_implemento: '',
                    filial_origem: '',
                    filial_destino: '',
                    km: '',
                    valor: ''
                });
                const [editing, setEditing] = React.useState(null);
                const [branches, setBranches] = React.useState([]);

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        const { data: disps, error: dispError } = await supabase
                            .from('deslocamentos')
                            .select('*')
                            .is('data_encerramento', null)
                            .order('created_at', { ascending: false });
                        if (dispError) throw dispError;
                        setDisplacements(disps);

                        const { data: branchList, error: branchError } = await supabase
                            .from('filiais')
                            .select('name');
                        if (branchError) throw branchError;
                        setBranches(branchList.map(b => b.name));

                    } catch (e) {
                        console.error("Erro ao buscar dados de deslocamentos:", e);
                        showToast("Erro ao carregar dados.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleChange = (e) => {
                    const { name, value } = e.target;
                    setForm(prev => ({ ...prev, [name]: value }));
                };

                const handleAdd = async (e) => {
                    e.preventDefault();
                    if (!form.tipo_implemento || !form.filial_origem || !form.filial_destino || !form.km || !form.valor) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('deslocamentos')
                            .insert([{
                                tipo_implemento: form.tipo_implemento,
                                filial_origem: form.filial_origem,
                                filial_destino: form.filial_destino,
                                km: parseFloat(form.km),
                                valor: parseFloat(form.valor),
                                created_by_username: userId,
                                data_criacao: new Date().toISOString().slice(0, 10),
                            }]);
                        if (error) throw error;
                        showToast("Registro de deslocamento adicionado com sucesso!", "success");
                        setForm({
                            tipo_implemento: '',
                            filial_origem: '',
                            filial_destino: '',
                            km: '',
                            valor: ''
                        });
                        setIsFormVisible(false);
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao adicionar deslocamento:", e);
                        showToast("Erro ao adicionar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleEditClick = (record) => {
                    setEditing(record);
                    setIsFormVisible(true);
                    setForm({
                        tipo_implemento: record.tipo_implemento,
                        filial_origem: record.filial_origem,
                        filial_destino: record.filial_destino,
                        km: record.km,
                        valor: record.valor,
                    });
                };

                const handleUpdate = async (e) => {
                    e.preventDefault();
                    if (!form.tipo_implemento || !form.filial_origem || !form.filial_destino || !form.km || !form.valor) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        // 1. Encerrar o registro antigo
                        const { error: endError } = await supabase
                            .from('deslocamentos')
                            .update({ data_encerramento: new Date().toISOString().slice(0, 10) })
                            .eq('id', editing.id);
                        if (endError) throw endError;

                        // 2. Criar um novo registro com os dados atualizados
                        const { error: newError } = await supabase
                            .from('deslocamentos')
                            .insert([{
                                tipo_implemento: form.tipo_implemento,
                                filial_origem: form.filial_origem,
                                filial_destino: form.filial_destino,
                                km: parseFloat(form.km),
                                valor: parseFloat(form.valor),
                                created_by_username: userId,
                                data_criacao: new Date().toISOString().slice(0, 10),
                            }]);
                        if (newError) throw newError;

                        showToast("Registro de deslocamento atualizado com sucesso!", "success");
                        setEditing(null);
                        setIsFormVisible(false);
                        setForm({
                            tipo_implemento: '',
                            filial_origem: '',
                            filial_destino: '',
                            km: '',
                            valor: ''
                        });
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao atualizar registro:", e);
                        showToast("Erro ao atualizar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Precificação - Deslocamentos"),
                                userRole === 'administrador' && React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => {
                                        setIsFormVisible(!isFormVisible);
                                        setEditing(null);
                                        setForm({ tipo_implemento: '', filial_origem: '', filial_destino: '', km: '', valor: '' });
                                    }
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    isFormVisible ? "Ocultar Formulário" : "Adicionar Deslocamento"
                                )
                            ),
                            isFormVisible && React.createElement('form', { onSubmit: editing ? handleUpdate : handleAdd, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "tipo_implemento", className: "block text-sm font-medium text-gray-700" }, "Tipo de Implemento"),
                                        React.createElement('input', {
                                            type: "text",
                                            name: "tipo_implemento",
                                            value: form.tipo_implemento,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "Carreta, caminhão, etc.",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "filial_origem", className: "block text-sm font-medium text-gray-700" }, "Filial Origem"),
                                        React.createElement('select', {
                                            name: "filial_origem",
                                            value: form.filial_origem,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione"),
                                            branches.map(branch => React.createElement('option', { key: branch, value: branch }, branch))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "filial_destino", className: "block text-sm font-medium text-gray-700" }, "Filial Destino"),
                                        React.createElement('select', {
                                            name: "filial_destino",
                                            value: form.filial_destino,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione"),
                                            branches.map(branch => React.createElement('option', { key: branch, value: branch }, branch))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "km", className: "block text-sm font-medium text-gray-700" }, "KM"),
                                        React.createElement('input', {
                                            type: "number",
                                            name: "km",
                                            value: form.km,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "KM",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "valor", className: "block text-sm font-medium text-gray-700" }, "Valor"),
                                        React.createElement('input', {
                                            type: "number",
                                            name: "valor",
                                            value: form.valor,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "R$",
                                            required: true
                                        })
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4 space-x-2" },
                                    editing && React.createElement('button', {
                                        type: "button",
                                        onClick: () => {
                                            setEditing(null);
                                            setIsFormVisible(false);
                                            setForm({ tipo_implemento: '', filial_origem: '', filial_destino: '', km: '', valor: '' });
                                        },
                                        className: "px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-150 ease-in-out shadow-md"
                                    }, "Cancelar"),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: `px-6 py-2 ${editing ? 'bg-green-600' : 'bg-blue-600'} text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md`,
                                        disabled: isLoading
                                    }, editing ? "Atualizar" : "Adicionar")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Tipo de Implemento"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial Origem"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial Destino"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "KM"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Valor"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data Criação"),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 7, className: "text-center py-4" }, "Carregando..."))
                                        ) : displacements.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 7, className: "text-center py-4 text-gray-500" }, "Nenhum registro de deslocamento encontrado."))
                                        ) : (
                                            displacements.map(disp => (
                                                React.createElement('tr', { key: disp.id, className: "hover:bg-gray-50" },
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, disp.tipo_implemento),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, disp.filial_origem),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, disp.filial_destino),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, disp.km),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, `R$ ${disp.valor.toFixed(2)}`),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, new Date(disp.data_criacao).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                        React.createElement('button', { onClick: () => handleEditClick(disp), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                            React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente de Precificação Adicional Cidades
            function AdditionalCitiesPricing({ userId, userRole, showToast }) {
                const [cities, setCities] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [isFormVisible, setIsFormVisible] = React.useState(false);
                const [form, setForm] = React.useState({
                    filial: '',
                    municipio: '',
                    km: '',
                    valor: ''
                });
                const [editing, setEditing] = React.useState(null);
                const [branches, setBranches] = React.useState([]);

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        const { data: cityList, error: cityError } = await supabase
                            .from('adicionais_cidades')
                            .select('*')
                            .is('data_encerramento', null)
                            .order('created_at', { ascending: false });
                        if (cityError) throw cityError;
                        setCities(cityList);

                        const { data: branchList, error: branchError } = await supabase
                            .from('filiais')
                            .select('name');
                        if (branchError) throw branchError;
                        setBranches(branchList.map(b => b.name));
                    } catch (e) {
                        console.error("Erro ao buscar dados de cidades:", e);
                        showToast("Erro ao carregar dados.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleChange = (e) => {
                    const { name, value } = e.target;
                    setForm(prev => ({ ...prev, [name]: value }));
                };

                const handleAdd = async (e) => {
                    e.preventDefault();
                    if (!form.filial || !form.municipio || !form.km || !form.valor) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('adicionais_cidades')
                            .insert([{
                                filial: form.filial,
                                municipio: form.municipio,
                                km: parseFloat(form.km),
                                valor: parseFloat(form.valor),
                                created_by_username: userId,
                                data_criacao: new Date().toISOString().slice(0, 10),
                            }]);
                        if (error) throw error;
                        showToast("Registro de cidade adicional adicionado com sucesso!", "success");
                        setForm({ filial: '', municipio: '', km: '', valor: '' });
                        setIsFormVisible(false);
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao adicionar cidade adicional:", e);
                        showToast("Erro ao adicionar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleEditClick = (record) => {
                    setEditing(record);
                    setIsFormVisible(true);
                    setForm({
                        filial: record.filial,
                        municipio: record.municipio,
                        km: record.km,
                        valor: record.valor,
                    });
                };

                const handleUpdate = async (e) => {
                    e.preventDefault();
                    if (!form.filial || !form.municipio || !form.km || !form.valor) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const { error: endError } = await supabase
                            .from('adicionais_cidades')
                            .update({ data_encerramento: new Date().toISOString().slice(0, 10) })
                            .eq('id', editing.id);
                        if (endError) throw endError;

                        const { error: newError } = await supabase
                            .from('adicionais_cidades')
                            .insert([{
                                filial: form.filial,
                                municipio: form.municipio,
                                km: parseFloat(form.km),
                                valor: parseFloat(form.valor),
                                created_by_username: userId,
                                data_criacao: new Date().toISOString().slice(0, 10),
                            }]);
                        if (newError) throw newError;

                        showToast("Registro de cidade adicional atualizado com sucesso!", "success");
                        setEditing(null);
                        setIsFormVisible(false);
                        setForm({ filial: '', municipio: '', km: '', valor: '' });
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao atualizar registro:", e);
                        showToast("Erro ao atualizar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Precificação - Adicional Cidades"),
                                userRole === 'administrador' && React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => {
                                        setIsFormVisible(!isFormVisible);
                                        setEditing(null);
                                        setForm({ filial: '', municipio: '', km: '', valor: '' });
                                    }
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    isFormVisible ? "Ocultar Formulário" : "Adicionar Adicional Cidades"
                                )
                            ),
                            isFormVisible && React.createElement('form', { onSubmit: editing ? handleUpdate : handleAdd, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "filial", className: "block text-sm font-medium text-gray-700" }, "Filial"),
                                        React.createElement('select', {
                                            name: "filial",
                                            value: form.filial,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione"),
                                            branches.map(branch => React.createElement('option', { key: branch, value: branch }, branch))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "municipio", className: "block text-sm font-medium text-gray-700" }, "Município"),
                                        React.createElement('input', {
                                            type: "text",
                                            name: "municipio",
                                            value: form.municipio,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "Nome do município",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "km", className: "block text-sm font-medium text-gray-700" }, "KM"),
                                        React.createElement('input', {
                                            type: "number",
                                            name: "km",
                                            value: form.km,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "KM",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "valor", className: "block text-sm font-medium text-gray-700" }, "Valor"),
                                        React.createElement('input', {
                                            type: "number",
                                            name: "valor",
                                            value: form.valor,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "R$",
                                            required: true
                                        })
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4 space-x-2" },
                                    editing && React.createElement('button', {
                                        type: "button",
                                        onClick: () => {
                                            setEditing(null);
                                            setIsFormVisible(false);
                                            setForm({ filial: '', municipio: '', km: '', valor: '' });
                                        },
                                        className: "px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-150 ease-in-out shadow-md"
                                    }, "Cancelar"),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: `px-6 py-2 ${editing ? 'bg-green-600' : 'bg-blue-600'} text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md`,
                                        disabled: isLoading
                                    }, editing ? "Atualizar" : "Adicionar")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Município"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "KM"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Valor"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data Criação"),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 6, className: "text-center py-4" }, "Carregando..."))
                                        ) : cities.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 6, className: "text-center py-4 text-gray-500" }, "Nenhum registro de cidade adicional encontrado."))
                                        ) : (
                                            cities.map(city => (
                                                React.createElement('tr', { key: city.id, className: "hover:bg-gray-50" },
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, city.filial),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, city.municipio),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, city.km),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, `R$ ${city.valor.toFixed(2)}`),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, new Date(city.data_criacao).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                        React.createElement('button', { onClick: () => handleEditClick(city), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                            React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente de Precificação Preço Fixo
            function FixedPricePricing({ userId, userRole, showToast }) {
                const [prices, setPrices] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [isFormVisible, setIsFormVisible] = React.useState(false);
                const [form, setForm] = React.useState({
                    tipo_implemento: '',
                    filial: '',
                    preco: ''
                });
                const [editing, setEditing] = React.useState(null);
                const [branches, setBranches] = React.useState([]);

                React.useEffect(() => {
                    fetchData();
                }, []);

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        const { data: priceList, error: priceError } = await supabase
                            .from('precos_fixos')
                            .select('*')
                            .is('data_encerramento', null)
                            .order('created_at', { ascending: false });
                        if (priceError) throw priceError;
                        setPrices(priceList);

                        const { data: branchList, error: branchError } = await supabase
                            .from('filiais')
                            .select('name');
                        if (branchError) throw branchError;
                        setBranches(branchList.map(b => b.name));
                    } catch (e) {
                        console.error("Erro ao buscar dados de preços fixos:", e);
                        showToast("Erro ao carregar dados.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleChange = (e) => {
                    const { name, value } = e.target;
                    setForm(prev => ({ ...prev, [name]: value }));
                };

                const handleAdd = async (e) => {
                    e.preventDefault();
                    if (!form.tipo_implemento || !form.filial || !form.preco) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('precos_fixos')
                            .insert([{
                                tipo_implemento: form.tipo_implemento,
                                filial: form.filial,
                                preco: parseFloat(form.preco),
                                created_by_username: userId,
                                data_criacao: new Date().toISOString().slice(0, 10),
                            }]);
                        if (error) throw error;
                        showToast("Registro de preço fixo adicionado com sucesso!", "success");
                        setForm({ tipo_implemento: '', filial: '', preco: '' });
                        setIsFormVisible(false);
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao adicionar preço fixo:", e);
                        showToast("Erro ao adicionar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleEditClick = (record) => {
                    setEditing(record);
                    setIsFormVisible(true);
                    setForm({
                        tipo_implemento: record.tipo_implemento,
                        filial: record.filial,
                        preco: record.preco,
                    });
                };

                const handleUpdate = async (e) => {
                    e.preventDefault();
                    if (!form.tipo_implemento || !form.filial || !form.preco) {
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const { error: endError } = await supabase
                            .from('precos_fixos')
                            .update({ data_encerramento: new Date().toISOString().slice(0, 10) })
                            .eq('id', editing.id);
                        if (endError) throw endError;

                        const { error: newError } = await supabase
                            .from('precos_fixos')
                            .insert([{
                                tipo_implemento: form.tipo_implemento,
                                filial: form.filial,
                                preco: parseFloat(form.preco),
                                created_by_username: userId,
                                data_criacao: new Date().toISOString().slice(0, 10),
                            }]);
                        if (newError) throw newError;

                        showToast("Registro de preço fixo atualizado com sucesso!", "success");
                        setEditing(null);
                        setIsFormVisible(false);
                        setForm({ tipo_implemento: '', filial: '', preco: '' });
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao atualizar registro:", e);
                        showToast("Erro ao atualizar registro.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-xl" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "Precificação - Preço Fixo"),
                                userRole === 'administrador' && React.createElement('button', {
                                    className: "flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-150 ease-in-out shadow-md",
                                    onClick: () => {
                                        setIsFormVisible(!isFormVisible);
                                        setEditing(null);
                                        setForm({ tipo_implemento: '', filial: '', preco: '' });
                                    }
                                },
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "w-5 h-5 mr-2" }),
                                    isFormVisible ? "Ocultar Formulário" : "Adicionar Preço Fixo"
                                )
                            ),
                            isFormVisible && React.createElement('form', { onSubmit: editing ? handleUpdate : handleAdd, className: "mb-6 p-4 border rounded-md shadow-sm" },
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "tipo_implemento", className: "block text-sm font-medium text-gray-700" }, "Tipo de Implemento"),
                                        React.createElement('input', {
                                            type: "text",
                                            name: "tipo_implemento",
                                            value: form.tipo_implemento,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "Carreta, caminhão, etc.",
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "filial", className: "block text-sm font-medium text-gray-700" }, "Filial"),
                                        React.createElement('select', {
                                            name: "filial",
                                            value: form.filial,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            required: true
                                        },
                                            React.createElement('option', { value: "" }, "Selecione"),
                                            branches.map(branch => React.createElement('option', { key: branch, value: branch }, branch))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "preco", className: "block text-sm font-medium text-gray-700" }, "Preço"),
                                        React.createElement('input', {
                                            type: "number",
                                            name: "preco",
                                            value: form.preco,
                                            onChange: handleChange,
                                            className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",
                                            placeholder: "R$",
                                            required: true
                                        })
                                    )
                                ),
                                React.createElement('div', { className: "flex justify-end mt-4 space-x-2" },
                                    editing && React.createElement('button', {
                                        type: "button",
                                        onClick: () => {
                                            setEditing(null);
                                            setIsFormVisible(false);
                                            setForm({ tipo_implemento: '', filial: '', preco: '' });
                                        },
                                        className: "px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-150 ease-in-out shadow-md"
                                    }, "Cancelar"),
                                    React.createElement('button', {
                                        type: "submit",
                                        className: `px-6 py-2 ${editing ? 'bg-green-600' : 'bg-blue-600'} text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md`,
                                        disabled: isLoading
                                    }, editing ? "Atualizar" : "Adicionar")
                                )
                            ),
                            React.createElement('div', { className: "overflow-x-auto shadow-md rounded-lg" },
                                React.createElement('table', { className: "min-w-full leading-normal" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Tipo de Implemento"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Filial"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Preço"),
                                            React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" }, "Data Criação"),
                                            userRole === 'administrador' && React.createElement('th', { className: "px-5 py-3 border-b-2 border-gray-200 bg-gray-100" }, "Ações")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        isLoading ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: "text-center py-4" }, "Carregando..."))
                                        ) : prices.length === 0 ? (
                                            React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: "text-center py-4 text-gray-500" }, "Nenhum registro de preço fixo encontrado."))
                                        ) : (
                                            prices.map(price => (
                                                React.createElement('tr', { key: price.id, className: "hover:bg-gray-50" },
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, price.tipo_implemento),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, price.filial),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, `R$ ${price.preco.toFixed(2)}`),
                                                    React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm" }, new Date(price.data_criacao).toLocaleDateString()),
                                                    userRole === 'administrador' && React.createElement('td', { className: "px-5 py-5 border-b border-gray-200 bg-white text-sm text-right" },
                                                        React.createElement('button', { onClick: () => handleEditClick(price), className: "text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out" },
                                                            React.createElement(LucideIcon, { name: "Edit", className: "w-5 h-5" })
                                                        )
                                                    )
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente Pai para o menu de Precificação
            function PricingManagement({ userId, userRole, showToast }) {
                const [subPage, setSubPage] = React.useState('deslocamentos'); // Estado para os subtópicos

                return (
                    React.createElement('div', { className: "container mx-auto p-4 md:p-8" },
                        React.createElement('div', { className: "mb-6 flex flex-wrap gap-2" },
                            React.createElement('button', {
                                className: `px-4 py-2 rounded-md transition-colors duration-200 ${subPage === 'deslocamentos' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`,
                                onClick: () => setSubPage('deslocamentos')
                            }, "Deslocamentos"),
                            React.createElement('button', {
                                className: `px-4 py-2 rounded-md transition-colors duration-200 ${subPage === 'adicionalCidades' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`,
                                onClick: () => setSubPage('adicionalCidades')
                            }, "Adicional Cidades"),
                            React.createElement('button', {
                                className: `px-4 py-2 rounded-md transition-colors duration-200 ${subPage === 'precoFixo' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`,
                                onClick: () => setSubPage('precoFixo')
                            }, "Preço Fixo")
                        ),
                        subPage === 'deslocamentos' && React.createElement(DisplacementPricing, { userId: userId, userRole: userRole, showToast: showToast }),
                        subPage === 'adicionalCidades' && React.createElement(AdditionalCitiesPricing, { userId: userId, userRole: userRole, showToast: showToast }),
                        subPage === 'precoFixo' && React.createElement(FixedPricePricing, { userId: userId, userRole: userRole, showToast: showToast })
                    )
                );
            }

            // Componente Principal
            function App() {
                const [isLoggedIn, setIsLoggedIn] = React.useState(false);
                const [currentPage, setCurrentPage] = React.useState('dashboard');
                const [userRole, setUserRole] = React.useState(null);
                const [userId, setUserId] = React.useState(null);
                const [toastMessage, setToastMessage] = React.useState(null);
                const [toastType, setToastType] = React.useState(null);

                React.useEffect(() => {
                    const storedRole = localStorage.getItem('userRole');
                    const storedUserId = localStorage.getItem('userId');
                    if (storedRole && storedUserId) {
                        setIsLoggedIn(true);
                        setUserRole(storedRole);
                        setUserId(storedUserId);
                    }
                }, []);

                const handleLogin = (role, id) => {
                    setIsLoggedIn(true);
                    setUserRole(role);
                    setUserId(id);
                    setCurrentPage('dashboard');
                };

                const handleLogout = () => {
                    setIsLoggedIn(false);
                    setUserRole(null);
                    setUserId(null);
                    localStorage.removeItem('userRole');
                    localStorage.removeItem('userId');
                };

                const showToast = (message, type) => {
                    setToastMessage(message);
                    setToastType(type);
                };

                const clearToast = () => {
                    setToastMessage(null);
                    setToastType(null);
                };

                const quickAccessButtons = [
                    { name: 'Dashboard', icon: 'LayoutDashboard', page: 'dashboard' },
                    { name: 'Filiais', icon: 'Building', page: 'branchManagement', adminOnly: true },
                    { name: 'Equipamentos', icon: 'Truck', page: 'equipmentManagement', adminOnly: true },
                    { name: 'Usuários', icon: 'Users', page: 'userManagement', adminOnly: true },
                    { name: 'Precificação', icon: 'Banknote', page: 'pricing' }, // NOVA ABA DE PRECIFICACAO
                ];

                const menuLinks = [
                    { name: 'Dashboard', page: 'dashboard', icon: 'LayoutDashboard' },
                    { name: 'Transferência de Filial', page: 'branchTransfer', icon: 'ArrowLeftRight' },
                    { name: 'Distribuição de Terceiros', page: 'outsourcingDistribution', icon: 'CalendarDays' },
                    { name: 'Precificação', page: 'pricing', icon: 'Banknote', adminOnly: true }, // NOVA ABA DE PRECIFICACAO
                    { name: 'Gerenciamento', page: '', icon: 'Settings', subLinks: [
                        { name: 'Filiais', page: 'branchManagement', icon: 'Building', adminOnly: true },
                        { name: 'Equipamentos', page: 'equipmentManagement', icon: 'Truck', adminOnly: true },
                        { name: 'Usuários', page: 'userManagement', icon: 'Users', adminOnly: true },
                    ]}
                ];

                function QuickAccessMenu({ setCurrentPage, showToast }) {
                    return React.createElement('div', { className: "bg-white rounded-lg shadow-md p-6 mb-8" },
                        React.createElement('h2', { className: "text-lg font-semibold text-gray-700 mb-4" }, "Acesso Rápido"),
                        React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" },
                            quickAccessButtons.filter(btn => !btn.adminOnly || userRole === 'administrador').map(btn => (
                                React.createElement('button', {
                                    key: btn.page,
                                    onClick: () => setCurrentPage(btn.page),
                                    className: "flex flex-col items-center justify-center p-4 bg-gray-100 rounded-lg transition-colors duration-200 hover:bg-gray-200"
                                },
                                    React.createElement(LucideIcon, { name: btn.icon, className: "w-8 h-8 text-blue-600 mb-2" }),
                                    React.createElement('span', { className: "text-sm text-gray-700 font-medium" }, btn.name)
                                )
                            ))
                        )
                    );
                }

                function Sidebar() {
                    const [isMenuOpen, setIsMenuOpen] = React.useState(false);
                    const [openSubMenu, setOpenSubMenu] = React.useState(null);

                    const toggleMenu = () => {
                        setIsMenuOpen(!isMenuOpen);
                    };

                    const handleLinkClick = (page, hasSubLinks) => {
                        if (hasSubLinks) {
                            setOpenSubMenu(openSubMenu === page ? null : page);
                        } else {
                            setCurrentPage(page);
                            setIsMenuOpen(false);
                        }
                    };

                    return React.createElement(React.Fragment, null,
                        React.createElement('button', {
                            className: "fixed top-4 left-4 z-50 p-2 text-gray-600 md:hidden",
                            onClick: toggleMenu
                        },
                            React.createElement(LucideIcon, { name: "Menu", className: "w-6 h-6" })
                        ),
                        React.createElement('div', { className: `fixed inset-y-0 left-0 w-64 bg-white shadow-xl transform ${isMenuOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-40 flex flex-col` },
                            React.createElement('div', { className: "p-4 flex justify-between items-center border-b" },
                                React.createElement('div', { className: "flex items-center space-x-2" },
                                    React.createElement('img', { src: "https://gfivmnnysomfwrffybeh.supabase.co/storage/v1/object/public/logo//LOGO_TERSYS-removebg-preview%20(1).png", alt: "TERSYS", className: "h-8" }),
                                    React.createElement('span', { className: "font-semibold text-lg text-gray-800" }, "TERSYS")
                                ),
                                React.createElement('button', { onClick: toggleMenu, className: "md:hidden p-2 rounded-md hover:bg-gray-100 transition-colors" },
                                    React.createElement(LucideIcon, { name: "X", className: "w-6 h-6" })
                                )
                            ),
                            React.createElement('nav', { className: "flex-1 px-2 py-4 space-y-2 overflow-y-auto custom-scrollbar" },
                                menuLinks.filter(link => !link.adminOnly || userRole === 'administrador').map(link => (
                                    React.createElement('div', { key: link.page || link.name },
                                        React.createElement('a', {
                                            href: "#",
                                            onClick: (e) => {
                                                e.preventDefault();
                                                handleLinkClick(link.page, link.subLinks);
                                            },
                                            className: `flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 ${currentPage === link.page ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-50'}`
                                        },
                                            React.createElement(LucideIcon, { name: link.icon, className: `w-5 h-5 mr-3 ${currentPage === link.page ? 'text-blue-600' : 'text-gray-500'}` }),
                                            link.name,
                                            link.subLinks && React.createElement(LucideIcon, { name: openSubMenu === link.page ? "ChevronUp" : "ChevronDown", className: "w-4 h-4 ml-auto" })
                                        ),
                                        link.subLinks && openSubMenu === link.page && (
                                            React.createElement('div', { className: "pl-6 mt-1 space-y-1" },
                                                link.subLinks.filter(subLink => !subLink.adminOnly || userRole === 'administrador').map(subLink => (
                                                    React.createElement('a', {
                                                        key: subLink.page,
                                                        href: "#",
                                                        onClick: (e) => {
                                                            e.preventDefault();
                                                            setCurrentPage(subLink.page);
                                                            setIsMenuOpen(false);
                                                        },
                                                        className: `flex items-center px-4 py-2 text-sm rounded-md transition-colors duration-200 ${currentPage === subLink.page ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-600 hover:bg-gray-50'}`
                                                    },
                                                        React.createElement(LucideIcon, { name: subLink.icon, className: `w-4 h-4 mr-3 ${currentPage === subLink.page ? 'text-blue-600' : 'text-gray-500'}` }),
                                                        subLink.name
                                                    )
                                                ))
                                            )
                                        )
                                    )
                                ))
                            ),
                            React.createElement('div', { className: "p-4 border-t" },
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: "w-full flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-red-600 hover:bg-red-50"
                                },
                                    React.createElement(LucideIcon, { name: "LogOut", className: "w-5 h-5 mr-3" }),
                                    "Sair"
                                )
                            )
                        )
                    );
                }

                if (!isLoggedIn) {
                    return React.createElement(LoginPage, { onLogin: handleLogin });
                }

                return (
                    React.createElement('div', { className: "flex min-h-screen bg-gray-100" },
                        React.createElement(Sidebar, { setCurrentPage: setCurrentPage, currentPage: currentPage, userRole: userRole }),
                        React.createElement('main', { className: "flex-1 p-4 md:p-8 overflow-y-auto" },
                            React.createElement(QuickAccessMenu, { setCurrentPage: setCurrentPage, showToast: showToast }),
                            currentPage === 'dashboard' && React.createElement(Dashboard, { userId: userId, showToast: showToast }),
                            currentPage === 'branchManagement' && userRole === 'administrador' && React.createElement(BranchManagement, { userId: userId, userRole: userRole, showToast: showToast }),
                            currentPage === 'equipmentManagement' && userRole === 'administrador' && React.createElement(EquipmentManagement, { userId: userId, showToast: showToast }),
                            currentPage === 'userManagement' && userRole === 'administrador' && React.createElement(UserManagement, { userId: userId, showToast: showToast }),
                            currentPage === 'pricing' && userRole === 'administrador' && React.createElement(PricingManagement, { userId: userId, userRole: userRole, showToast: showToast }),
                            currentPage === 'outsourcingDistribution' && React.createElement(OutsourcingDistribution, { userId: userId, showToast: showToast, setCurrentPage: setCurrentPage }),
                            currentPage === 'branchTransfer' && React.createElement(BranchTransfer, { userId: userId, setCurrentPage: setCurrentPage, showToast: showToast }),
                            toastMessage && React.createElement(Toast, { message: toastMessage, type: toastType, onClose: clearToast })
                        )
                    )
                );
            }

            // ReactDOM.render(React.createElement(App, null), document.getElementById('root')); // This will be called after Supabase loads
        }; // End of window.onload
    </script>
</body>
</html>
